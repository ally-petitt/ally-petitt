<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Tutorial on Ally Petitt</title>
    <link>http://localhost:1313/ally-petitt/en/tags/tutorial/</link>
    <description>Recent content in Tutorial on Ally Petitt</description>
    <generator>Hugo -- 0.125.4</generator>
    <language>en</language>
    <lastBuildDate>Mon, 01 Jan 2024 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/ally-petitt/en/tags/tutorial/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>How to Find more Vulnerabilities — Source Code Auditing Explained</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2024-01-01_how-to-find-more-vulnerabilities---source-code-auditing-explained-2c8a10896374/</link>
      <pubDate>Mon, 01 Jan 2024 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2024-01-01_how-to-find-more-vulnerabilities---source-code-auditing-explained-2c8a10896374/</guid>
      <description>&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*jDmBerRWYf3eZh2J&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://images.pexels.com/photos/374559/pexels-photo-374559.jpeg?auto=compress&amp;amp;cs=tinysrgb&amp;amp;w=1260&amp;amp;h=750&amp;amp;dpr=1&#34;&gt;https://images.pexels.com/photos/374559/pexels-photo-374559.jpeg?auto=compress&amp;amp;cs=tinysrgb&amp;amp;w=1260&amp;amp;h=750&amp;amp;dpr=1&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Whitebox penetration testing can be intimidating. Complex web applications may contain hundreds of thousands of lines of code and deciphering the connection between the various web components and their numerous implementations is challenging. A powerful, yet simple technique to approach the code review of such an application is to break it into manageable pieces.&lt;/p&gt;
&lt;p&gt;In this article, I will be outlining a methodology that can be used to break down large web applications, such as Content Management Systems (CMSs) into manageable components that can be systematically analyzed for vulnerabilities or logic errors. This is the approach that I used to discover CVE-2023–43154 and it is the approach taught in the AWAE, OffSec’s prerequisite course to the OffSec Web Expert (OSWE) certification.&lt;/p&gt;
&lt;p&gt;Note that this article has an emphasis on web security, but the methodology can be applied to other fields of research as well.&lt;/p&gt;
&lt;p&gt;Let’s begin.&lt;/p&gt;
&lt;h1 id=&#34;methodology&#34;&gt;Methodology&lt;/h1&gt;
&lt;p&gt;At a high level, this methodology begins with gaining familiarity with the application as a whole. This phase includes&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Identifying the technology stack — programming language, templating engine, database, etc..&lt;/li&gt;
&lt;li&gt;Mapping out the application to gain a high-level overview of the structure of the project — commands like &lt;code&gt;tree -L 3&lt;/code&gt; may be used.&lt;/li&gt;
&lt;li&gt;Reading documentation&lt;/li&gt;
&lt;li&gt;Understanding common use cases of the application&lt;/li&gt;
&lt;li&gt;Exploring the application through its interface&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These steps help to develop a holistic understanding of the application. This enables you to better relate your subsequent findings to how the application is used, aiding in a more accurate assessment of impact and the likelihood of a successful exploit.&lt;/p&gt;
&lt;p&gt;Then, the approach can branch into either of two directions: bottom-up or top-down. To understand what this means, it is first important to define what is meant by a “source” and a “sink”. From there, it will become more clear what is meant by the aforementioned approaches.&lt;/p&gt;
&lt;h2 id=&#34;sources-andsinks&#34;&gt;Sources and Sinks&lt;/h2&gt;
&lt;p&gt;Vulnerabilities in web applications commonly arise from the manner in which user input is handled. The entry point for user input is referred to as a source. An example of this would be input from a form, a query parameter in the URL, or a cookie. These are sources of user input that are then interpreted and handled by the web application.&lt;/p&gt;
&lt;p&gt;A sink, on the contrary, is where the user input is actually used. This is where the vulnerability occurs. In the case of a SQL injection, the source may be a query parameter that has contents concatenated with a SQL query.&lt;/p&gt;
&lt;p&gt;To further illustrate this point, I will provide an example. The vulnerable PHP code below has a source, &lt;code&gt;comment&lt;/code&gt; , and a sink, &lt;code&gt;&amp;lt;?php echo $_GET[‘comment’]; ?&amp;gt;&lt;/code&gt;. The lack of sanitization on the PHP code as it echos the user input results in an XSS vulnerability.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;!-- Source: https://example.com/?comment=&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt; --&amp;gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;div id=&amp;#34;comment&amp;#34;&amp;gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &amp;lt;!-- Sink --&amp;gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &amp;lt;?php echo $\_GET[&amp;#39;comment&amp;#39;]; ?&amp;gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/div&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For a more visual explanation, this &lt;a href=&#34;https://youtu.be/ZaOtY4i5w_U?si=zXfJBsNlhp4h-CLa&#34;&gt;LiveOverflow&lt;/a&gt; video provides an excellent demonstration of the topic.&lt;/p&gt;
&lt;h2 id=&#34;bottom-up-approach&#34;&gt;Bottom-Up Approach&lt;/h2&gt;
&lt;p&gt;The bottom-up approach refers to first locating sinks and tracing the code “upwards” to the source. For instance, I may search the code base for all occurrences of the sink &lt;code&gt;system()&lt;/code&gt;, and from there follow the value that is passed into the function to search for any user input that may be implemented into that parameter.&lt;/p&gt;
&lt;p&gt;Regular expressions are a common technique to speed up the process of finding sinks. Patterns such as &lt;code&gt;^.*unserialize\(.+\)&lt;/code&gt; may be used to locate specific sinks (in this case, the &lt;code&gt;unserialize()&lt;/code&gt; function) with more accuracy and can be used to narrow down the search effort. It is important to note, however, that this method has limitations. The regex results are only as strong as the pattern used and even well-established regular expressions can miss vulnerabilities and sinks.&lt;/p&gt;
&lt;p&gt;This method is generally more tedious since not all occurrences of a sink will be used in the context of user-controlled data. Therefore, there can be more code to parse through in order to find a bug. Despite its repetitiveness, this approach has the advantage of increasing the likelihood of finding &lt;strong&gt;higher severity and less accessible vulnerabilities&lt;/strong&gt; that are very difficult, if not impossible, to discover without access to the source code.&lt;/p&gt;
&lt;h2 id=&#34;top-down-approach&#34;&gt;Top-Down Approach&lt;/h2&gt;
&lt;p&gt;On the contrary, the top-down approach consists of identifying sources and following their implementation in the code until a sink is found. For instance, I may submit the string &lt;code&gt;“test”&lt;/code&gt; into a &lt;code&gt;EditProfile&lt;/code&gt; functionality on a website. A top-down approach would consist of finding where the &lt;code&gt;“test”&lt;/code&gt; string is received in the code and following the logic used on it until I locate its sink, or implementation, in a SQL query.&lt;/p&gt;
&lt;p&gt;Regular expressions can be used here as well. A basic example is &lt;code&gt;^.*?query&lt;/code&gt; to find query parameters. Regular expressions will typically become more complex depending on the specific context and the vulnerabilities that they are searching for.&lt;/p&gt;
&lt;p&gt;This approach excels in finding vulnerabilities that are &lt;strong&gt;more accessible, but typically less severe&lt;/strong&gt;. To clarify, high severity and high accessibility vulnerabilities can be discovered through either approach. One approach will simply increase your likelihood of finding a particular kind of vulnerability and the one that is chosen will depend on the individual priorities of the code review.&lt;/p&gt;
&lt;h2 id=&#34;functionality-based-approach&#34;&gt;Functionality-Based Approach&lt;/h2&gt;
&lt;p&gt;A different perspective on code review is breaking the application down into sections based on functionality. Instead of starting broad with all of the application’s sources or sinks and then narrowing down into a vulnerable one, this approach involves starting narrow with one functionality and learning how it works on a deeper level in order to search for vulnerabilities in that particular segment of the application.&lt;/p&gt;
&lt;p&gt;This approach is particularly useful when prioritizing certain types of vulnerabilities based on factors such as required authentication level. In this instance, one can curate a list of functionalities that can be used without authentication and analyze those for vulnerabilities. Prioritization is a useful tool when auditing large code bases to increase the chances of finding higher severity vulnerabilities or medium-low severity vulnerabilities that can more elegantly be chained together to result in a higher-severity attack.&lt;/p&gt;
&lt;h1 id=&#34;tooling&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*UPqLe8hb4dLd2h30&#34; alt=&#34;&#34;  /&gt;

Tooling&lt;/h1&gt;
&lt;p&gt;I previously mentioned that searching through the code with regular expressions can be used to quickly identify sources and sinks. In addition to this, tools such as Semgrep can also be used to grep for certain patterns in the code. Semgrep looks at the code as more than a text file. It develops and abstract syntax tree (AST) in order to better understand the semantics. This can lead to its recognition of a certain vulnerable pattern in code that a regex pattern would miss. On the other hand, both are only as strong as the way they were written and they can lead to many false positives.&lt;/p&gt;
&lt;p&gt;Static Application Security Testing (SAST) solutions can also aide in identifying vulnerabilities. &lt;a href=&#34;https://spectralops.io/&#34;&gt;SpectralOps&lt;/a&gt;, Checkmarx, and Veracode are all examples of SAST tools used by organizations. I have not tried any of these at the time of writing, so I can not recommend one with certainty. SAST tools are generally meant for use by developers in the CI/CD pipeline, but they can also be used by researchers.&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;The approach to static analysis that you use will impact the types of vulnerabilities that you are more likely and their likelihood of being exploitable. I encourage you to experiment with different approaches to static analysis and decide for yourself which methods work best for your goals. A mixed approach is quite common and even encouraged for best results.&lt;/p&gt;
&lt;p&gt;Happy hacking!&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*jDmBerRWYf3eZh2J" alt=""  />

<em><a href="https://images.pexels.com/photos/374559/pexels-photo-374559.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1">https://images.pexels.com/photos/374559/pexels-photo-374559.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1</a></em></p>
<h1 id="introduction">Introduction</h1>
<p>Whitebox penetration testing can be intimidating. Complex web applications may contain hundreds of thousands of lines of code and deciphering the connection between the various web components and their numerous implementations is challenging. A powerful, yet simple technique to approach the code review of such an application is to break it into manageable pieces.</p>
<p>In this article, I will be outlining a methodology that can be used to break down large web applications, such as Content Management Systems (CMSs) into manageable components that can be systematically analyzed for vulnerabilities or logic errors. This is the approach that I used to discover CVE-2023–43154 and it is the approach taught in the AWAE, OffSec’s prerequisite course to the OffSec Web Expert (OSWE) certification.</p>
<p>Note that this article has an emphasis on web security, but the methodology can be applied to other fields of research as well.</p>
<p>Let’s begin.</p>
<h1 id="methodology">Methodology</h1>
<p>At a high level, this methodology begins with gaining familiarity with the application as a whole. This phase includes</p>
<ul>
<li>Identifying the technology stack — programming language, templating engine, database, etc..</li>
<li>Mapping out the application to gain a high-level overview of the structure of the project — commands like <code>tree -L 3</code> may be used.</li>
<li>Reading documentation</li>
<li>Understanding common use cases of the application</li>
<li>Exploring the application through its interface</li>
</ul>
<p>These steps help to develop a holistic understanding of the application. This enables you to better relate your subsequent findings to how the application is used, aiding in a more accurate assessment of impact and the likelihood of a successful exploit.</p>
<p>Then, the approach can branch into either of two directions: bottom-up or top-down. To understand what this means, it is first important to define what is meant by a “source” and a “sink”. From there, it will become more clear what is meant by the aforementioned approaches.</p>
<h2 id="sources-andsinks">Sources and Sinks</h2>
<p>Vulnerabilities in web applications commonly arise from the manner in which user input is handled. The entry point for user input is referred to as a source. An example of this would be input from a form, a query parameter in the URL, or a cookie. These are sources of user input that are then interpreted and handled by the web application.</p>
<p>A sink, on the contrary, is where the user input is actually used. This is where the vulnerability occurs. In the case of a SQL injection, the source may be a query parameter that has contents concatenated with a SQL query.</p>
<p>To further illustrate this point, I will provide an example. The vulnerable PHP code below has a source, <code>comment</code> , and a sink, <code>&lt;?php echo $_GET[‘comment’]; ?&gt;</code>. The lack of sanitization on the PHP code as it echos the user input results in an XSS vulnerability.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;!-- Source: https://example.com/?comment=&lt;script&gt;alert(1)&lt;/script&gt; --&gt;  
</span></span><span style="display:flex;"><span>&lt;div id=&#34;comment&#34;&gt;  
</span></span><span style="display:flex;"><span> &lt;!-- Sink --&gt;  
</span></span><span style="display:flex;"><span> &lt;?php echo $\_GET[&#39;comment&#39;]; ?&gt;   
</span></span><span style="display:flex;"><span>&lt;/div&gt;
</span></span></code></pre></div><p>For a more visual explanation, this <a href="https://youtu.be/ZaOtY4i5w_U?si=zXfJBsNlhp4h-CLa">LiveOverflow</a> video provides an excellent demonstration of the topic.</p>
<h2 id="bottom-up-approach">Bottom-Up Approach</h2>
<p>The bottom-up approach refers to first locating sinks and tracing the code “upwards” to the source. For instance, I may search the code base for all occurrences of the sink <code>system()</code>, and from there follow the value that is passed into the function to search for any user input that may be implemented into that parameter.</p>
<p>Regular expressions are a common technique to speed up the process of finding sinks. Patterns such as <code>^.*unserialize\(.+\)</code> may be used to locate specific sinks (in this case, the <code>unserialize()</code> function) with more accuracy and can be used to narrow down the search effort. It is important to note, however, that this method has limitations. The regex results are only as strong as the pattern used and even well-established regular expressions can miss vulnerabilities and sinks.</p>
<p>This method is generally more tedious since not all occurrences of a sink will be used in the context of user-controlled data. Therefore, there can be more code to parse through in order to find a bug. Despite its repetitiveness, this approach has the advantage of increasing the likelihood of finding <strong>higher severity and less accessible vulnerabilities</strong> that are very difficult, if not impossible, to discover without access to the source code.</p>
<h2 id="top-down-approach">Top-Down Approach</h2>
<p>On the contrary, the top-down approach consists of identifying sources and following their implementation in the code until a sink is found. For instance, I may submit the string <code>“test”</code> into a <code>EditProfile</code> functionality on a website. A top-down approach would consist of finding where the <code>“test”</code> string is received in the code and following the logic used on it until I locate its sink, or implementation, in a SQL query.</p>
<p>Regular expressions can be used here as well. A basic example is <code>^.*?query</code> to find query parameters. Regular expressions will typically become more complex depending on the specific context and the vulnerabilities that they are searching for.</p>
<p>This approach excels in finding vulnerabilities that are <strong>more accessible, but typically less severe</strong>. To clarify, high severity and high accessibility vulnerabilities can be discovered through either approach. One approach will simply increase your likelihood of finding a particular kind of vulnerability and the one that is chosen will depend on the individual priorities of the code review.</p>
<h2 id="functionality-based-approach">Functionality-Based Approach</h2>
<p>A different perspective on code review is breaking the application down into sections based on functionality. Instead of starting broad with all of the application’s sources or sinks and then narrowing down into a vulnerable one, this approach involves starting narrow with one functionality and learning how it works on a deeper level in order to search for vulnerabilities in that particular segment of the application.</p>
<p>This approach is particularly useful when prioritizing certain types of vulnerabilities based on factors such as required authentication level. In this instance, one can curate a list of functionalities that can be used without authentication and analyze those for vulnerabilities. Prioritization is a useful tool when auditing large code bases to increase the chances of finding higher severity vulnerabilities or medium-low severity vulnerabilities that can more elegantly be chained together to result in a higher-severity attack.</p>
<h1 id="tooling"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*UPqLe8hb4dLd2h30" alt=""  />

Tooling</h1>
<p>I previously mentioned that searching through the code with regular expressions can be used to quickly identify sources and sinks. In addition to this, tools such as Semgrep can also be used to grep for certain patterns in the code. Semgrep looks at the code as more than a text file. It develops and abstract syntax tree (AST) in order to better understand the semantics. This can lead to its recognition of a certain vulnerable pattern in code that a regex pattern would miss. On the other hand, both are only as strong as the way they were written and they can lead to many false positives.</p>
<p>Static Application Security Testing (SAST) solutions can also aide in identifying vulnerabilities. <a href="https://spectralops.io/">SpectralOps</a>, Checkmarx, and Veracode are all examples of SAST tools used by organizations. I have not tried any of these at the time of writing, so I can not recommend one with certainty. SAST tools are generally meant for use by developers in the CI/CD pipeline, but they can also be used by researchers.</p>
<h1 id="conclusion">Conclusion</h1>
<p>The approach to static analysis that you use will impact the types of vulnerabilities that you are more likely and their likelihood of being exploitable. I encourage you to experiment with different approaches to static analysis and decide for yourself which methods work best for your goals. A mixed approach is quite common and even encouraged for best results.</p>
<p>Happy hacking!</p>
]]></content:encoded>
    </item>
    <item>
      <title>How to safely convert to LVM without losing your data</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2023-08-19_how-to-safely-convert-to-lvm-without-losing-your-data-258ce044448/</link>
      <pubDate>Sat, 19 Aug 2023 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2023-08-19_how-to-safely-convert-to-lvm-without-losing-your-data-258ce044448/</guid>
      <description>&lt;h1 id=&#34;introduction&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*es1LJrnEBsSNgXZM.png&#34; alt=&#34;&#34;  /&gt;

Introduction&lt;/h1&gt;
&lt;p&gt;This article is a walkthrough that demonstrates the solution to a particular situation that computer owners may encounter when updating their system. For readers who do not fit into the scenario listed below, this is also a great article for familiarizing yourself with the practical application of logical volume manager (LVM). Otherwise, feel free to modify your approach as works best with your scenario.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Scenario:&lt;/strong&gt; You have a hard drive with all your files on it that uses physical partitions. You just bought a new hard drive and would like to use both drives together to manage logical partitions rather than physical ones. You also don’t want to lose the data that was on your original physical partitions.&lt;/p&gt;
&lt;p&gt;As implied from above, the only requirements for this approach are that you have a system that can use LVM and you have a storage device with equal or greater size than the amount of data stored on the primary storage device. Additionally, it is assumed that you are using Linux.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; This has the potential to cause damage and potentially brick your system. Your implementation may also vary depending on your setup. Continue at your own risk.&lt;/p&gt;
&lt;h2 id=&#34;benefits-oflvm&#34;&gt;Benefits of LVM&lt;/h2&gt;
&lt;p&gt;The full scope of LVMs capabilities can be seen &lt;a href=&#34;https://man7.org/linux/man-pages/man8/lvm.8.html&#34;&gt;here&lt;/a&gt;. It is a flexible utility that offers unique advantages over traditional physical partitions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Grouping multiple drives into a single volume group&lt;/li&gt;
&lt;li&gt;Support for &lt;a href=&#34;https://en.wikipedia.org/wiki/Thin_provisioning&#34;&gt;thin provisioning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Snapshot capabilities that can be used for backups&lt;/li&gt;
&lt;li&gt;Easy to resize partitions and add/remove drives&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;More detail on the benefits can be found &lt;a href=&#34;https://linuxhint.com/whatis_logical_volume_management/&#34;&gt;here&lt;/a&gt;. We are now ready to discuss the steps to convert to LVM.&lt;/p&gt;
&lt;h1 id=&#34;steps-to-safely-convert-tolvm&#34;&gt;Steps to Safely Convert to LVM&lt;/h1&gt;
&lt;p&gt;For the purpose of this article, the primary storage device used will be referred to as &lt;code&gt;sda&lt;/code&gt; and the new storage device will be called &lt;code&gt;sdb&lt;/code&gt;. An overview of the plan is the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Create LVM group on &lt;code&gt;sdb&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Copy data from &lt;code&gt;sda&lt;/code&gt;partitions to &lt;code&gt;sdb&lt;/code&gt; logical partitions&lt;/li&gt;
&lt;li&gt;Expand LVM group on &lt;code&gt;sdb&lt;/code&gt; to include unused &lt;code&gt;sda&lt;/code&gt; partitions&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;prerequisite&#34;&gt;Prerequisite&lt;/h2&gt;
&lt;p&gt;Install the LVM tools and &lt;code&gt;rsync&lt;/code&gt; with the command that is appropriate with your Linux distribution.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install lvm2 rsync # For Ubuntu/Debian  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pacman -Sy lvm2 rsync # Arch Linux
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;Create LVM group on &lt;code&gt;sdb&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Create a volume group called &lt;code&gt;myvg&lt;/code&gt; on &lt;code&gt;sdb&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo pvcreate /dev/sdb  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo vgcreate myvg /dev/sdb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Create a logical volume&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Create a logical volume on the &lt;code&gt;myvg&lt;/code&gt; volume group to store the new data in. This one is named &lt;code&gt;backup&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo lvcreate -n backup -L 300G myvg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To verify your progress, you can run the commands &lt;code&gt;sudo vgs&lt;/code&gt; and &lt;code&gt;sudo lvs&lt;/code&gt; to list the recently created volume groups and logical volumes.&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Mount the new logical volume&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Create a filesystem. For quick creation, just press the Enter key for each of the prompts.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkfs.ext4 /dev/myvg/backup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, create a mount point and mount the &lt;code&gt;backup&lt;/code&gt; logical volume to it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir /mnt/backup  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mount /dev/myvg/backup /mnt/backup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Copy data to the logical volume&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Then, mount the partition that you would like to transfer onto a new mount point. For instance, I would like to transfer &lt;code&gt;sda3&lt;/code&gt; onto &lt;code&gt;backup&lt;/code&gt; so I will use the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mount /dev/sda3 /mnt/root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this case, &lt;code&gt;rsync&lt;/code&gt; will be used to transfer the files from &lt;code&gt;sda&lt;/code&gt; to &lt;code&gt;sdb&lt;/code&gt;. In this case, the 500GB portion of &lt;code&gt;sdb&lt;/code&gt; that was used to create the &lt;code&gt;backup&lt;/code&gt; logical volume. After, I will unmount the logical volume and physical partition.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo rsync -av /mnt/root /mnt/backup  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo umount /mnt/backup  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo umount /dev/root
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Repeat steps 2–4 with all of the partitions that you with to preserve.&lt;/strong&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Expand the LVM volumes&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Now, we will add &lt;code&gt;sda2&lt;/code&gt; and &lt;code&gt;sda3&lt;/code&gt; into the volume group of LVM. In order to do this, we must initialize them as physical volumes and extend them to the volume group.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pvcreate /dev/sdY  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo vgextend myvg /dev/sdY
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Add new partitions to fstab&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;Finally, find the UUIDs of the new logical volumes with &lt;code&gt;lsblk -f&lt;/code&gt; and add those to your &lt;code&gt;/etc/fstab&lt;/code&gt; with the following syntax:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;UUID=&amp;lt;your-home-uuid&amp;gt; /home ext4 rw,relatime 0 2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;UUID=&amp;lt;your-root-uuid&amp;gt; / ext4 rw,relatime 0 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As always, make changes to the above configuration option if necessary.&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;These are the steps that worked for me with my setup. I hope that you found this article helpful and informative. Feel free to reach out if you have any questions.&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<h1 id="introduction"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*es1LJrnEBsSNgXZM.png" alt=""  />

Introduction</h1>
<p>This article is a walkthrough that demonstrates the solution to a particular situation that computer owners may encounter when updating their system. For readers who do not fit into the scenario listed below, this is also a great article for familiarizing yourself with the practical application of logical volume manager (LVM). Otherwise, feel free to modify your approach as works best with your scenario.</p>
<p><strong>Scenario:</strong> You have a hard drive with all your files on it that uses physical partitions. You just bought a new hard drive and would like to use both drives together to manage logical partitions rather than physical ones. You also don’t want to lose the data that was on your original physical partitions.</p>
<p>As implied from above, the only requirements for this approach are that you have a system that can use LVM and you have a storage device with equal or greater size than the amount of data stored on the primary storage device. Additionally, it is assumed that you are using Linux.</p>
<p><strong>Warning:</strong> This has the potential to cause damage and potentially brick your system. Your implementation may also vary depending on your setup. Continue at your own risk.</p>
<h2 id="benefits-oflvm">Benefits of LVM</h2>
<p>The full scope of LVMs capabilities can be seen <a href="https://man7.org/linux/man-pages/man8/lvm.8.html">here</a>. It is a flexible utility that offers unique advantages over traditional physical partitions:</p>
<ul>
<li>Grouping multiple drives into a single volume group</li>
<li>Support for <a href="https://en.wikipedia.org/wiki/Thin_provisioning">thin provisioning</a></li>
<li>Snapshot capabilities that can be used for backups</li>
<li>Easy to resize partitions and add/remove drives</li>
</ul>
<p>More detail on the benefits can be found <a href="https://linuxhint.com/whatis_logical_volume_management/">here</a>. We are now ready to discuss the steps to convert to LVM.</p>
<h1 id="steps-to-safely-convert-tolvm">Steps to Safely Convert to LVM</h1>
<p>For the purpose of this article, the primary storage device used will be referred to as <code>sda</code> and the new storage device will be called <code>sdb</code>. An overview of the plan is the following:</p>
<ol>
<li>Create LVM group on <code>sdb</code></li>
<li>Copy data from <code>sda</code>partitions to <code>sdb</code> logical partitions</li>
<li>Expand LVM group on <code>sdb</code> to include unused <code>sda</code> partitions</li>
</ol>
<h2 id="prerequisite">Prerequisite</h2>
<p>Install the LVM tools and <code>rsync</code> with the command that is appropriate with your Linux distribution.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt-get install lvm2 rsync # For Ubuntu/Debian  
</span></span><span style="display:flex;"><span>sudo pacman -Sy lvm2 rsync # Arch Linux
</span></span></code></pre></div><ol>
<li>Create LVM group on <code>sdb</code></li>
</ol>
<hr>
<p>Create a volume group called <code>myvg</code> on <code>sdb</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo pvcreate /dev/sdb  
</span></span><span style="display:flex;"><span>$ sudo vgcreate myvg /dev/sdb
</span></span></code></pre></div><ol start="2">
<li>Create a logical volume</li>
</ol>
<hr>
<p>Create a logical volume on the <code>myvg</code> volume group to store the new data in. This one is named <code>backup</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo lvcreate -n backup -L 300G myvg
</span></span></code></pre></div><p>To verify your progress, you can run the commands <code>sudo vgs</code> and <code>sudo lvs</code> to list the recently created volume groups and logical volumes.</p>
<ol start="3">
<li>Mount the new logical volume</li>
</ol>
<hr>
<p>Create a filesystem. For quick creation, just press the Enter key for each of the prompts.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo mkfs.ext4 /dev/myvg/backup
</span></span></code></pre></div><p>Then, create a mount point and mount the <code>backup</code> logical volume to it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo mkdir /mnt/backup  
</span></span><span style="display:flex;"><span>sudo mount /dev/myvg/backup /mnt/backup
</span></span></code></pre></div><ol start="4">
<li>Copy data to the logical volume</li>
</ol>
<hr>
<p>Then, mount the partition that you would like to transfer onto a new mount point. For instance, I would like to transfer <code>sda3</code> onto <code>backup</code> so I will use the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo mount /dev/sda3 /mnt/root
</span></span></code></pre></div><p>In this case, <code>rsync</code> will be used to transfer the files from <code>sda</code> to <code>sdb</code>. In this case, the 500GB portion of <code>sdb</code> that was used to create the <code>backup</code> logical volume. After, I will unmount the logical volume and physical partition.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo rsync -av /mnt/root /mnt/backup  
</span></span><span style="display:flex;"><span>sudo umount /mnt/backup  
</span></span><span style="display:flex;"><span>sudo umount /dev/root
</span></span></code></pre></div><p><strong>Repeat steps 2–4 with all of the partitions that you with to preserve.</strong></p>
<ol start="5">
<li>Expand the LVM volumes</li>
</ol>
<hr>
<p>Now, we will add <code>sda2</code> and <code>sda3</code> into the volume group of LVM. In order to do this, we must initialize them as physical volumes and extend them to the volume group.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo pvcreate /dev/sdY  
</span></span><span style="display:flex;"><span>sudo vgextend myvg /dev/sdY
</span></span></code></pre></div><ol start="5">
<li>Add new partitions to fstab</li>
</ol>
<hr>
<p>Finally, find the UUIDs of the new logical volumes with <code>lsblk -f</code> and add those to your <code>/etc/fstab</code> with the following syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>UUID=&lt;your-home-uuid&gt; /home ext4 rw,relatime 0 2  
</span></span><span style="display:flex;"><span>UUID=&lt;your-root-uuid&gt; / ext4 rw,relatime 0 1
</span></span></code></pre></div><p>As always, make changes to the above configuration option if necessary.</p>
<h1 id="conclusion">Conclusion</h1>
<p>These are the steps that worked for me with my setup. I hope that you found this article helpful and informative. Feel free to reach out if you have any questions.</p>
]]></content:encoded>
    </item>
    <item>
      <title>5 Ways I Found Your Deleted Files</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2023-05-13_5-ways-i-found-your-deleted-files-492407dbd467/</link>
      <pubDate>Sat, 13 May 2023 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2023-05-13_5-ways-i-found-your-deleted-files-492407dbd467/</guid>
      <description>&lt;h2 id=&#34;computer-forensics-for-filerecovery&#34;&gt;Computer Forensics for File Recovery&lt;/h2&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*MnBiAcwiwaFGOOAe.jpg&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://edgy.app/wp-content/uploads/2018/04/dataleakhackerGorodenkoff-970x546.jpg&#34;&gt;https://edgy.app/wp-content/uploads/2018/04/dataleakhackerGorodenkoff-970x546.jpg&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;When a file is “deleted”, its contents aren’t typically erased from the storage device that it was stored on. More often than not, the blocks that stored the file are marked as unallocated and the filesystem pointers are removed from it. The implication is that the file still exists on the disk until it is overwritten.&lt;/p&gt;
&lt;p&gt;There are many methods to recovering the raw, unallocated data. &lt;a href=&#34;https://forensics.wiki/tools_data_recovery/&#34;&gt;This website&lt;/a&gt; lists many tools that can be used for file recovery in different scenarios. In this article, I’ll be walking through 5 different tools that can be used to recover data.&lt;/p&gt;
&lt;h1 id=&#34;setup&#34;&gt;Setup&lt;/h1&gt;
&lt;p&gt;I’ll be using doing forensic analysis on a drive that I created and attached to my Kali Linux VM. To see how this is done, you can reference &lt;a href=&#34;https://opensource.com/article/19/4/create-filesystem-linux-partition&#34;&gt;this article&lt;/a&gt;. On this drive, I saved and then deleted an image file and text file.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*HRHkhSM5bBjI9ouCYNpU4w.png&#34; alt=&#34;Image of commands I used to set up file system for forensic analysis&#34;  /&gt;

I’ll start by doing general enumeration on the disk image. Then, I’ll showcase a variety of file recovery techniques used by forensic analysts that allowed me to recover the deleted files. Many of the tools used will be from the &lt;a href=&#34;http://sleuthkit.org/sleuthkit&#34;&gt;Sleuth Kit&lt;/a&gt; (TSK).&lt;/p&gt;
&lt;p&gt;Before starting, I’ll unmount the filesystem, create a duplicate of it, remove write permissions from the duplicate, and verify the integrity of the duplicate against the original hash of &lt;code&gt;/dev/sdb&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cd ../ &amp;amp;&amp;amp; umount /mnt/secret # unmount /mnt/secret  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ dd if=/dev/sdb of=/home/kali/forensics/sdb.img # copy /dev/sdb into sdb.img  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;22286+0 records in  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;22286+0 records out  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;11410432 bytes (11 MB, 11 MiB) copied, 0.0412053 s, 277 MB/s  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ chmod a-w /home/kali/forensics/sdb.img # remove write access to the image  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ md5sum /home/kali/forensics/sdb.img /dev/sdb  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;6c49fb21916d59e0df69453959392e23 /home/kali/forensics/sdb.img  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;6c49fb21916d59e0df69453959392e23 /dev/sdb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;enumeration&#34;&gt;Enumeration&lt;/h1&gt;
&lt;h2 id=&#34;image-analysis&#34;&gt;Image Analysis&lt;/h2&gt;
&lt;p&gt;Using the &lt;code&gt;file&lt;/code&gt; command reveals that the image uses an ext4 file system.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*4gowWgQfJ4J1FXwjFHjhQg.png&#34; alt=&#34;&#34;  /&gt;

Furthermore, the &lt;code&gt;stat&lt;/code&gt; command displays information about the image such as its size, time stamps, and block details.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*_T8VXPuyfnuQ7Rm5WNIOsQ.png&#34; alt=&#34;output of the stat command&#34;  /&gt;

With the information that the image uses ext4, the &lt;code&gt;fsstat&lt;/code&gt; command can be used to extract more detailed information about the file system, metadata, content data, and block groups.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ fsstat -f ext4 sdb.img   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FILE SYSTEM INFORMATION  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------------------------  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File System Type: Ext4  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Volume Name:   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Volume ID: dc8a4fb36dce8eabee4c51cf01c2d52a  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Last Written at: 2023-05-09 22:35:31 (EDT)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Last Checked at: 2023-05-09 22:23:26 (EDT)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Last Mounted at: 2023-05-09 22:24:27 (EDT)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Unmounted properly  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Last mounted on: /mnt/secret  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Source OS: Linux  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Dynamic Structure  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Compat Features: Journal, Ext Attributes, Resize Inode, Dir Index  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;InCompat Features: Filetype, Extents, 64bit, Flexible Block Groups,   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Read Only Compat Features: Sparse Super, Large File, Huge File, Extra Inode Size  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Journal ID: 00  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Journal Inode: 8  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;METADATA INFORMATION  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------------------------  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Inode Range: 1 - 2785  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Root Directory: 2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Free Inodes: 2773  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Inode Size: 256  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CONTENT INFORMATION  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------------------------  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Block Groups Per Flex Group: 16  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Block Range: 0 - 11139  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Block Size: 1024  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Reserved Blocks Before Block Groups: 1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Free Blocks: 9223  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BLOCK GROUP INFORMATION  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------------------------  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Number of Block Groups: 2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Inodes per group: 1392  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Blocks per group: 8192  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Group: 0:  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Block Group Flags: [INODE\_ZEROED]   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode Range: 1 - 1392  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Block Range: 1 - 8192  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Layout:  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Super Block: 1 - 1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Group Descriptor Table: 2 - 2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Group Descriptor Growth Blocks: 3 - 89  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Data bitmap: 90 - 90  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode bitmap: 92 - 92  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode Table: 94 - 441  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Uninit Data Bitmaps: 92 - 105  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Uninit Inode Bitmaps: 94 - 107  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Uninit Inode Table: 790 - 5661  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Data Blocks: 5690 - 8192  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Free Inodes: 1381 (99%)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Free Blocks: 6365 (77%)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Total Directories: 2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Stored Checksum: 0x7DEB  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Group: 1:  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Block Group Flags: [INODE\_UNINIT, INODE\_ZEROED]   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode Range: 1393 - 2784  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Block Range: 8193 - 11139  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Layout:  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Super Block: 8193 - 8193  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Group Descriptor Table: 8194 - 8194  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Group Descriptor Growth Blocks: 8195 - 8281  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Data bitmap: 91 - 91  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode bitmap: 93 - 93  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Inode Table: 442 - 789  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Data Blocks: 8282 - 11139  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Free Inodes: 1392 (100%)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Free Blocks: 2858 (96%)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Total Directories: 0  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Stored Checksum: 0xDFA7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on this output, it is clear that the block size is 1024 bits, there are 1113 total blocks, and there are 2785 inodes.&lt;/p&gt;
&lt;p&gt;In addition, &lt;code&gt;parted&lt;/code&gt; can be used to find more information on the partition table, which can be useful when using scalpel.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*EAJIlLWQ5g3rEgqc5nPNbQ.png&#34; alt=&#34;&#34;  /&gt;

Finally, running &lt;code&gt;strings&lt;/code&gt; on the image gives more insight as to what is in the filesystem. It appears that my &lt;code&gt;secret.txt&lt;/code&gt; file with the contents &lt;code&gt;Hello World&lt;/code&gt; is appearing from the &lt;code&gt;strings&lt;/code&gt; command in addition to a failed image download attempt.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*hINgjWeGy7ttVHl1qDs1EQ.png&#34; alt=&#34;&#34;  /&gt;

In the command &lt;code&gt;strings -a --radix=d sdb.img&lt;/code&gt;, &lt;code&gt;-a&lt;/code&gt; is an option to scan the entire file and &lt;code&gt;--radix=d&lt;/code&gt; tells &lt;code&gt;strings&lt;/code&gt; to show the offset that the string was found at in base 10.&lt;/p&gt;
&lt;h2 id=&#34;analyzing-thefiles&#34;&gt;Analyzing the Files&lt;/h2&gt;
&lt;p&gt;This particular image does not have any files currently in it aside from deleted files, so there isn’t much information to gain from mounting it and analyzing the files. In cases where it is desireable to do so, the following command can be used:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ mount -o ro,loop,noexec,noatime sdb.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Below, I’ll explain what the options do:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-o&lt;/code&gt;: sets the options for mounting &lt;code&gt;sdb.img&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ro&lt;/strong&gt;: an option to mount the file system as being read-only&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;loop&lt;/strong&gt;: mount the file system on a loop device&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;noexec&lt;/strong&gt;: disallow execution&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;noatime&lt;/strong&gt;: don’t change the access time of the files&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can then continue to run &lt;code&gt;file&lt;/code&gt; on the files within the mounted loop device and save their md5 hashes to verify integrity.&lt;/p&gt;
&lt;h1 id=&#34;recovering-thefiles&#34;&gt;Recovering the Files&lt;/h1&gt;
&lt;h2 id=&#34;method-1-using-sleuthkithttpsleuthkitorgsleuthkit&#34;&gt;Method 1: Using &lt;a href=&#34;http://sleuthkit.org/sleuthkit/&#34;&gt;Sleuth Kit&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Often, if you have deleted files, they may be displayed with &lt;code&gt;fls sdb.img&lt;/code&gt;, enumerated with &lt;code&gt;istat -o &amp;lt;offset&amp;gt; sdb.img &amp;lt;inode_number&amp;gt;&lt;/code&gt;, and recovered with &lt;code&gt;icat -o &amp;lt;offset&amp;gt; sdb.img &amp;lt;inode_number&amp;gt;&lt;/code&gt;. An example of the latter 2 steps are shown in the screenshot below.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*mc44fgKV8os0qCVpYYZiJQ.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://www.therootuser.com/wp-content/uploads/2017/11/Screenshot-2017-11-07-17.27.58.png&#34;&gt;https://www.therootuser.com/wp-content/uploads/2017/11/Screenshot-2017-11-07-17.27.58.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This does not appear to be the case for me, however. My deleted files are not appearing from the &lt;code&gt;fls&lt;/code&gt; command. Instead, I see a variable called &lt;code&gt;$OrphanFiles&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*hQXtm0cZ7wge3IgQlexR-Q.png&#34; alt=&#34;&#34;  /&gt;

&lt;code&gt;$OrphanFiles&lt;/code&gt; are files that still exist in the image, but are no longer able to be accessed from the root directory. &lt;code&gt;$OrphanFiles&lt;/code&gt; is not an actual directory on the image, it is Sleuth Kit’s virtual way to demonstrate that the file metadata still exists (&lt;a href=&#34;https://wiki.sleuthkit.org/index.php?title=Orphan_Files&#34;&gt;read more&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;To recover these orphan files, I will attempt a few techniques starting with &lt;code&gt;extundelete&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;method-2-extundeletehttpsextundeletesourceforgenet&#34;&gt;Method 2: &lt;a href=&#34;https://extundelete.sourceforge.net/&#34;&gt;Extundelete&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This tool can be used to recover files on ext3 and ext4 filesystems. I was having some difficulties with the build from &lt;code&gt;apt&lt;/code&gt;, so I build the program from source with the following commands to it working again:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt update &amp;amp;&amp;amp; apt install -y libext2fs-dev   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://github.com/cherojeong/extundelete.git  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./configure  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;make  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;src/extundelete --restore-all /path/to/image.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;os &amp;lt;&amp;lt; “Directory ACL: “ &amp;lt;&amp;lt; inode.i_dir_acl &amp;lt;&amp;lt; std::endl;&lt;/code&gt; with &lt;code&gt;os &amp;lt;&amp;lt; “Directory ACL: “ &amp;lt;&amp;lt; inode.i_file_acl &amp;lt;&amp;lt; std::endl;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The command &lt;code&gt;extundelete --restore-all sdb.img&lt;/code&gt; can be used to recover files.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*Ipv-ABMSCpXNtc6PZT5zqQ.png&#34; alt=&#34;&#34;  /&gt;

As you can see in the screenshot above, the tool was unsuccessful in recovering the orphan files. This is still a viable option that can work in many scenarios which is why I decided to include it in this article.&lt;/p&gt;
&lt;p&gt;I’m not giving up yet. We’ll try again!&lt;/p&gt;
&lt;h2 id=&#34;method-3testdiskhttpswwwcgsecurityorgwikitestdisk&#34;&gt;Method 3: &lt;a href=&#34;https://www.cgsecurity.org/wiki/TestDisk&#34;&gt;TestDisk&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;.tar.bz&lt;/code&gt; file can be downloaded &lt;a href=&#34;https://www.cgsecurity.org/wiki/TestDisk_Download&#34;&gt;here&lt;/a&gt;. I’m using version 7.2. Note that in order for &lt;code&gt;TestDisk&lt;/code&gt; to work, you must run it in the download directory. Otherwise you might get an error like &lt;code&gt;*** Error in &lt;/code&gt;/path/to/testdisk-7.2-WIP/photorec_static&amp;rsquo;: malloc(): memory corruption: 0x0000000002617d29 ***`.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# extract and run the file  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar -xf testdisk-7.2-WIP.linux26-x86\_64.tar.bz2  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd testdisk-7.2-WIP  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./photorec\_static /path/to/sdb.img /log 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A help menu will appear. I’ll first select the image that I want to work with.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*vEuqI7RnAWsvLfrH9n88Pw.png&#34; alt=&#34;&#34;  /&gt;

Then, I select the option for the partition table for the media. Mine does not have one, so I choose “None”. I verified that this was the only option that was able to list files for me.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*c5iJeI2oyLMdmRu_bBD5Qg.png&#34; alt=&#34;&#34;  /&gt;

After this, I navigate to the “List” option at the bottom of the terminal and press &lt;code&gt;Enter&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*jl17is949wOoNF0JEzBcIg.png&#34; alt=&#34;&#34;  /&gt;

This leads me to the listing of the files on the image with the successfully recovered ones in &lt;strong&gt;red&lt;/strong&gt; text.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*yYQEslxR1RWkUbkEX743Bg.png&#34; alt=&#34;&#34;  /&gt;

As you can see in the screenshot, there are no new files there listed in red. This means that &lt;code&gt;TestDisk&lt;/code&gt; was unsuccessful in recovering the deleted files.&lt;/p&gt;
&lt;p&gt;It’s okay, I still got a few more tricks up my sleeve.&lt;/p&gt;
&lt;h2 id=&#34;method-4foremosthttpssourceforgenetprojectsforemost&#34;&gt;Method 4: &lt;a href=&#34;https://sourceforge.net/projects/foremost/&#34;&gt;Foremost&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Foremost can be installed with &lt;code&gt;apt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install foremost
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This tool uses a technique known as &lt;strong&gt;file carving&lt;/strong&gt; which involves searching through the raw data on a disk and carving out the values between the header and/or footer of the file.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*ayacIY6WQdxAYksd_nwT8g.png&#34; alt=&#34;&#34;  /&gt;

Alas, we were able to recover a deleted image file from the drive with &lt;code&gt;foremost -t jpeg -o recovered-files -i sdb.img&lt;/code&gt;. The recovered image renders as expected in the Image Viewer. What a pretty camp fire.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*kA2aubO7prDBFW9Xx0cGvQ.png&#34; alt=&#34;&#34;  /&gt;

The fact that this worked while the previous 3 methods did not further demonstrates that different tools and techniques will be more effective at data recovery in different scenarios.&lt;/p&gt;
&lt;p&gt;It’s also worth mentioning that you can edit the &lt;code&gt;/etc/foremost.conf&lt;/code&gt; file to contain your own custom headers and footers for the file you are looking for. Modifying these values will be explored in the next and final method.&lt;/p&gt;
&lt;h2 id=&#34;method-5scalpelhttpsgithubcomsleuthkitscalpel&#34;&gt;Method 5: &lt;a href=&#34;https://github.com/sleuthkit/scalpel&#34;&gt;Scalpel&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Scalpel is much like Foremost with added flexibility. You are not as limited on the file types and headers, although there is a way to modify foremost to have the same customization that scalpel provides.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install scalpel  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp /etc/scalpel/scalpel.conf .  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim scalpel.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I’ll edit the config with the bit of background information that I have. I know that I’m attempting to recover a JPEG file and I also know that there was a text file that began with the word “Hello”. By using &lt;code&gt;xxd&lt;/code&gt;, I can determine the file headers for a &lt;code&gt;.txt&lt;/code&gt; file starting with the word “Hello”. In this case, it would be &lt;code&gt;\x48\x65\x6c\x6c\x6f&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ echo -n Hello | xxd   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;00000000: 4865 6c6c 6f Hello.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We will use this information to update the &lt;code&gt;scalpel.conf&lt;/code&gt; file in &lt;code&gt;vim&lt;/code&gt;. As explained in the comments at the top of the config file, the first column indicates the file extension. The second is whether the header and footer are case sensitive, the third is the header in hexadecimal bytes, the fourth column is an optional footer, and the fifth column is an optional parameter to search backwards from the header rather than just forward.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*Y6kTU1JxILxivTOYbHN5tQ.png&#34; alt=&#34;&#34;  /&gt;

With these options set, &lt;code&gt;scalpel&lt;/code&gt; can now be ran to extract these files from the drive.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scalpel -o recovered-files\_scalpel -c scalpel.conf sdb.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*O3huS4-S2BausvT-s2KiYw.png&#34; alt=&#34;&#34;  /&gt;

It appears that the text file was successfully recovered.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*jASCyrkTBYVfhWQxZkk3lg.png&#34; alt=&#34;&#34;  /&gt;

The image was recovered as well.&lt;/p&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*5ixUUenRR50lIavpZ0oyIw.png&#34; alt=&#34;&#34;  /&gt;

Conclusion&lt;/h1&gt;
&lt;p&gt;There’s many ways to achieve the same outcome. The different tools showcased here have their specific applications where they perform best. Even though not all the methods outlined here worked for my particular situation, that doesn’t mean they won’t work for you. There are many factors that determine whether file recovery will be successful including the partitioning table type, how long it has been since they were deleted, the size of the file (smaller files are more likely to be recovered), the health of the storage device, and the operations that have been done on the drive since deleting the files such as reformatting the drive.&lt;/p&gt;
&lt;p&gt;I hope that through reading this article, you were able to deepen your understanding of file recovery and gain practical knowledge that you can apply in the real world. Thanks for reading and I’ll see you next time.&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<h2 id="computer-forensics-for-filerecovery">Computer Forensics for File Recovery</h2>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*MnBiAcwiwaFGOOAe.jpg" alt=""  />

<em><a href="https://edgy.app/wp-content/uploads/2018/04/dataleakhackerGorodenkoff-970x546.jpg">https://edgy.app/wp-content/uploads/2018/04/dataleakhackerGorodenkoff-970x546.jpg</a></em></p>
<h1 id="introduction">Introduction</h1>
<p>When a file is “deleted”, its contents aren’t typically erased from the storage device that it was stored on. More often than not, the blocks that stored the file are marked as unallocated and the filesystem pointers are removed from it. The implication is that the file still exists on the disk until it is overwritten.</p>
<p>There are many methods to recovering the raw, unallocated data. <a href="https://forensics.wiki/tools_data_recovery/">This website</a> lists many tools that can be used for file recovery in different scenarios. In this article, I’ll be walking through 5 different tools that can be used to recover data.</p>
<h1 id="setup">Setup</h1>
<p>I’ll be using doing forensic analysis on a drive that I created and attached to my Kali Linux VM. To see how this is done, you can reference <a href="https://opensource.com/article/19/4/create-filesystem-linux-partition">this article</a>. On this drive, I saved and then deleted an image file and text file.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*HRHkhSM5bBjI9ouCYNpU4w.png" alt="Image of commands I used to set up file system for forensic analysis"  />

I’ll start by doing general enumeration on the disk image. Then, I’ll showcase a variety of file recovery techniques used by forensic analysts that allowed me to recover the deleted files. Many of the tools used will be from the <a href="http://sleuthkit.org/sleuthkit">Sleuth Kit</a> (TSK).</p>
<p>Before starting, I’ll unmount the filesystem, create a duplicate of it, remove write permissions from the duplicate, and verify the integrity of the duplicate against the original hash of <code>/dev/sdb</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ cd ../ &amp;&amp; umount /mnt/secret # unmount /mnt/secret  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>$ dd if=/dev/sdb of=/home/kali/forensics/sdb.img # copy /dev/sdb into sdb.img  
</span></span><span style="display:flex;"><span>22286+0 records in  
</span></span><span style="display:flex;"><span>22286+0 records out  
</span></span><span style="display:flex;"><span>11410432 bytes (11 MB, 11 MiB) copied, 0.0412053 s, 277 MB/s  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>$ chmod a-w /home/kali/forensics/sdb.img # remove write access to the image  
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>$ md5sum /home/kali/forensics/sdb.img /dev/sdb  
</span></span><span style="display:flex;"><span>6c49fb21916d59e0df69453959392e23 /home/kali/forensics/sdb.img  
</span></span><span style="display:flex;"><span>6c49fb21916d59e0df69453959392e23 /dev/sdb
</span></span></code></pre></div><h1 id="enumeration">Enumeration</h1>
<h2 id="image-analysis">Image Analysis</h2>
<p>Using the <code>file</code> command reveals that the image uses an ext4 file system.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*4gowWgQfJ4J1FXwjFHjhQg.png" alt=""  />

Furthermore, the <code>stat</code> command displays information about the image such as its size, time stamps, and block details.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*_T8VXPuyfnuQ7Rm5WNIOsQ.png" alt="output of the stat command"  />

With the information that the image uses ext4, the <code>fsstat</code> command can be used to extract more detailed information about the file system, metadata, content data, and block groups.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ fsstat -f ext4 sdb.img   
</span></span><span style="display:flex;"><span>FILE SYSTEM INFORMATION  
</span></span><span style="display:flex;"><span>--------------------------------------------  
</span></span><span style="display:flex;"><span>File System Type: Ext4  
</span></span><span style="display:flex;"><span>Volume Name:   
</span></span><span style="display:flex;"><span>Volume ID: dc8a4fb36dce8eabee4c51cf01c2d52a  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Last Written at: 2023-05-09 22:35:31 (EDT)  
</span></span><span style="display:flex;"><span>Last Checked at: 2023-05-09 22:23:26 (EDT)  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Last Mounted at: 2023-05-09 22:24:27 (EDT)  
</span></span><span style="display:flex;"><span>Unmounted properly  
</span></span><span style="display:flex;"><span>Last mounted on: /mnt/secret  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Source OS: Linux  
</span></span><span style="display:flex;"><span>Dynamic Structure  
</span></span><span style="display:flex;"><span>Compat Features: Journal, Ext Attributes, Resize Inode, Dir Index  
</span></span><span style="display:flex;"><span>InCompat Features: Filetype, Extents, 64bit, Flexible Block Groups,   
</span></span><span style="display:flex;"><span>Read Only Compat Features: Sparse Super, Large File, Huge File, Extra Inode Size  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Journal ID: 00  
</span></span><span style="display:flex;"><span>Journal Inode: 8  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>METADATA INFORMATION  
</span></span><span style="display:flex;"><span>--------------------------------------------  
</span></span><span style="display:flex;"><span>Inode Range: 1 - 2785  
</span></span><span style="display:flex;"><span>Root Directory: 2  
</span></span><span style="display:flex;"><span>Free Inodes: 2773  
</span></span><span style="display:flex;"><span>Inode Size: 256  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>CONTENT INFORMATION  
</span></span><span style="display:flex;"><span>--------------------------------------------  
</span></span><span style="display:flex;"><span>Block Groups Per Flex Group: 16  
</span></span><span style="display:flex;"><span>Block Range: 0 - 11139  
</span></span><span style="display:flex;"><span>Block Size: 1024  
</span></span><span style="display:flex;"><span>Reserved Blocks Before Block Groups: 1  
</span></span><span style="display:flex;"><span>Free Blocks: 9223  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>BLOCK GROUP INFORMATION  
</span></span><span style="display:flex;"><span>--------------------------------------------  
</span></span><span style="display:flex;"><span>Number of Block Groups: 2  
</span></span><span style="display:flex;"><span>Inodes per group: 1392  
</span></span><span style="display:flex;"><span>Blocks per group: 8192  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Group: 0:  
</span></span><span style="display:flex;"><span> Block Group Flags: [INODE\_ZEROED]   
</span></span><span style="display:flex;"><span> Inode Range: 1 - 1392  
</span></span><span style="display:flex;"><span> Block Range: 1 - 8192  
</span></span><span style="display:flex;"><span> Layout:  
</span></span><span style="display:flex;"><span> Super Block: 1 - 1  
</span></span><span style="display:flex;"><span> Group Descriptor Table: 2 - 2  
</span></span><span style="display:flex;"><span> Group Descriptor Growth Blocks: 3 - 89  
</span></span><span style="display:flex;"><span> Data bitmap: 90 - 90  
</span></span><span style="display:flex;"><span> Inode bitmap: 92 - 92  
</span></span><span style="display:flex;"><span> Inode Table: 94 - 441  
</span></span><span style="display:flex;"><span> Uninit Data Bitmaps: 92 - 105  
</span></span><span style="display:flex;"><span> Uninit Inode Bitmaps: 94 - 107  
</span></span><span style="display:flex;"><span> Uninit Inode Table: 790 - 5661  
</span></span><span style="display:flex;"><span> Data Blocks: 5690 - 8192  
</span></span><span style="display:flex;"><span> Free Inodes: 1381 (99%)  
</span></span><span style="display:flex;"><span> Free Blocks: 6365 (77%)  
</span></span><span style="display:flex;"><span> Total Directories: 2  
</span></span><span style="display:flex;"><span> Stored Checksum: 0x7DEB  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>Group: 1:  
</span></span><span style="display:flex;"><span> Block Group Flags: [INODE\_UNINIT, INODE\_ZEROED]   
</span></span><span style="display:flex;"><span> Inode Range: 1393 - 2784  
</span></span><span style="display:flex;"><span> Block Range: 8193 - 11139  
</span></span><span style="display:flex;"><span> Layout:  
</span></span><span style="display:flex;"><span> Super Block: 8193 - 8193  
</span></span><span style="display:flex;"><span> Group Descriptor Table: 8194 - 8194  
</span></span><span style="display:flex;"><span> Group Descriptor Growth Blocks: 8195 - 8281  
</span></span><span style="display:flex;"><span> Data bitmap: 91 - 91  
</span></span><span style="display:flex;"><span> Inode bitmap: 93 - 93  
</span></span><span style="display:flex;"><span> Inode Table: 442 - 789  
</span></span><span style="display:flex;"><span> Data Blocks: 8282 - 11139  
</span></span><span style="display:flex;"><span> Free Inodes: 1392 (100%)  
</span></span><span style="display:flex;"><span> Free Blocks: 2858 (96%)  
</span></span><span style="display:flex;"><span> Total Directories: 0  
</span></span><span style="display:flex;"><span> Stored Checksum: 0xDFA7
</span></span></code></pre></div><p>Based on this output, it is clear that the block size is 1024 bits, there are 1113 total blocks, and there are 2785 inodes.</p>
<p>In addition, <code>parted</code> can be used to find more information on the partition table, which can be useful when using scalpel.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*EAJIlLWQ5g3rEgqc5nPNbQ.png" alt=""  />

Finally, running <code>strings</code> on the image gives more insight as to what is in the filesystem. It appears that my <code>secret.txt</code> file with the contents <code>Hello World</code> is appearing from the <code>strings</code> command in addition to a failed image download attempt.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*hINgjWeGy7ttVHl1qDs1EQ.png" alt=""  />

In the command <code>strings -a --radix=d sdb.img</code>, <code>-a</code> is an option to scan the entire file and <code>--radix=d</code> tells <code>strings</code> to show the offset that the string was found at in base 10.</p>
<h2 id="analyzing-thefiles">Analyzing the Files</h2>
<p>This particular image does not have any files currently in it aside from deleted files, so there isn’t much information to gain from mounting it and analyzing the files. In cases where it is desireable to do so, the following command can be used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ mount -o ro,loop,noexec,noatime sdb.img
</span></span></code></pre></div><p>Below, I’ll explain what the options do:</p>
<ul>
<li><code>-o</code>: sets the options for mounting <code>sdb.img</code>.</li>
<li><strong>ro</strong>: an option to mount the file system as being read-only</li>
<li><strong>loop</strong>: mount the file system on a loop device</li>
<li><strong>noexec</strong>: disallow execution</li>
<li><strong>noatime</strong>: don’t change the access time of the files</li>
</ul>
<p>You can then continue to run <code>file</code> on the files within the mounted loop device and save their md5 hashes to verify integrity.</p>
<h1 id="recovering-thefiles">Recovering the Files</h1>
<h2 id="method-1-using-sleuthkithttpsleuthkitorgsleuthkit">Method 1: Using <a href="http://sleuthkit.org/sleuthkit/">Sleuth Kit</a></h2>
<p>Often, if you have deleted files, they may be displayed with <code>fls sdb.img</code>, enumerated with <code>istat -o &lt;offset&gt; sdb.img &lt;inode_number&gt;</code>, and recovered with <code>icat -o &lt;offset&gt; sdb.img &lt;inode_number&gt;</code>. An example of the latter 2 steps are shown in the screenshot below.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*mc44fgKV8os0qCVpYYZiJQ.png" alt=""  />

<em><a href="https://www.therootuser.com/wp-content/uploads/2017/11/Screenshot-2017-11-07-17.27.58.png">https://www.therootuser.com/wp-content/uploads/2017/11/Screenshot-2017-11-07-17.27.58.png</a></em></p>
<p>This does not appear to be the case for me, however. My deleted files are not appearing from the <code>fls</code> command. Instead, I see a variable called <code>$OrphanFiles</code>.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*hQXtm0cZ7wge3IgQlexR-Q.png" alt=""  />

<code>$OrphanFiles</code> are files that still exist in the image, but are no longer able to be accessed from the root directory. <code>$OrphanFiles</code> is not an actual directory on the image, it is Sleuth Kit’s virtual way to demonstrate that the file metadata still exists (<a href="https://wiki.sleuthkit.org/index.php?title=Orphan_Files">read more</a>).</p>
<p>To recover these orphan files, I will attempt a few techniques starting with <code>extundelete</code>.</p>
<h2 id="method-2-extundeletehttpsextundeletesourceforgenet">Method 2: <a href="https://extundelete.sourceforge.net/">Extundelete</a></h2>
<p>This tool can be used to recover files on ext3 and ext4 filesystems. I was having some difficulties with the build from <code>apt</code>, so I build the program from source with the following commands to it working again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>apt update &amp;&amp; apt install -y libext2fs-dev   
</span></span><span style="display:flex;"><span>git clone https://github.com/cherojeong/extundelete.git  
</span></span><span style="display:flex;"><span>./configure  
</span></span><span style="display:flex;"><span>make  
</span></span><span style="display:flex;"><span>src/extundelete --restore-all /path/to/image.img
</span></span></code></pre></div><p><code>os &lt;&lt; “Directory ACL: “ &lt;&lt; inode.i_dir_acl &lt;&lt; std::endl;</code> with <code>os &lt;&lt; “Directory ACL: “ &lt;&lt; inode.i_file_acl &lt;&lt; std::endl;</code>.</p>
<p>The command <code>extundelete --restore-all sdb.img</code> can be used to recover files.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*Ipv-ABMSCpXNtc6PZT5zqQ.png" alt=""  />

As you can see in the screenshot above, the tool was unsuccessful in recovering the orphan files. This is still a viable option that can work in many scenarios which is why I decided to include it in this article.</p>
<p>I’m not giving up yet. We’ll try again!</p>
<h2 id="method-3testdiskhttpswwwcgsecurityorgwikitestdisk">Method 3: <a href="https://www.cgsecurity.org/wiki/TestDisk">TestDisk</a></h2>
<p>The <code>.tar.bz</code> file can be downloaded <a href="https://www.cgsecurity.org/wiki/TestDisk_Download">here</a>. I’m using version 7.2. Note that in order for <code>TestDisk</code> to work, you must run it in the download directory. Otherwise you might get an error like <code>*** Error in </code>/path/to/testdisk-7.2-WIP/photorec_static&rsquo;: malloc(): memory corruption: 0x0000000002617d29 ***`.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># extract and run the file  
</span></span><span style="display:flex;"><span>tar -xf testdisk-7.2-WIP.linux26-x86\_64.tar.bz2  
</span></span><span style="display:flex;"><span>cd testdisk-7.2-WIP  
</span></span><span style="display:flex;"><span>./photorec\_static /path/to/sdb.img /log 
</span></span></code></pre></div><p>A help menu will appear. I’ll first select the image that I want to work with.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*vEuqI7RnAWsvLfrH9n88Pw.png" alt=""  />

Then, I select the option for the partition table for the media. Mine does not have one, so I choose “None”. I verified that this was the only option that was able to list files for me.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*c5iJeI2oyLMdmRu_bBD5Qg.png" alt=""  />

After this, I navigate to the “List” option at the bottom of the terminal and press <code>Enter</code>.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*jl17is949wOoNF0JEzBcIg.png" alt=""  />

This leads me to the listing of the files on the image with the successfully recovered ones in <strong>red</strong> text.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*yYQEslxR1RWkUbkEX743Bg.png" alt=""  />

As you can see in the screenshot, there are no new files there listed in red. This means that <code>TestDisk</code> was unsuccessful in recovering the deleted files.</p>
<p>It’s okay, I still got a few more tricks up my sleeve.</p>
<h2 id="method-4foremosthttpssourceforgenetprojectsforemost">Method 4: <a href="https://sourceforge.net/projects/foremost/">Foremost</a></h2>
<p>Foremost can be installed with <code>apt</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt install foremost
</span></span></code></pre></div><p>This tool uses a technique known as <strong>file carving</strong> which involves searching through the raw data on a disk and carving out the values between the header and/or footer of the file.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*ayacIY6WQdxAYksd_nwT8g.png" alt=""  />

Alas, we were able to recover a deleted image file from the drive with <code>foremost -t jpeg -o recovered-files -i sdb.img</code>. The recovered image renders as expected in the Image Viewer. What a pretty camp fire.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*kA2aubO7prDBFW9Xx0cGvQ.png" alt=""  />

The fact that this worked while the previous 3 methods did not further demonstrates that different tools and techniques will be more effective at data recovery in different scenarios.</p>
<p>It’s also worth mentioning that you can edit the <code>/etc/foremost.conf</code> file to contain your own custom headers and footers for the file you are looking for. Modifying these values will be explored in the next and final method.</p>
<h2 id="method-5scalpelhttpsgithubcomsleuthkitscalpel">Method 5: <a href="https://github.com/sleuthkit/scalpel">Scalpel</a></h2>
<p>Scalpel is much like Foremost with added flexibility. You are not as limited on the file types and headers, although there is a way to modify foremost to have the same customization that scalpel provides.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt install scalpel  
</span></span><span style="display:flex;"><span>cp /etc/scalpel/scalpel.conf .  
</span></span><span style="display:flex;"><span>vim scalpel.conf
</span></span></code></pre></div><p>I’ll edit the config with the bit of background information that I have. I know that I’m attempting to recover a JPEG file and I also know that there was a text file that began with the word “Hello”. By using <code>xxd</code>, I can determine the file headers for a <code>.txt</code> file starting with the word “Hello”. In this case, it would be <code>\x48\x65\x6c\x6c\x6f</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ echo -n Hello | xxd   
</span></span><span style="display:flex;"><span>00000000: 4865 6c6c 6f Hello.
</span></span></code></pre></div><p>We will use this information to update the <code>scalpel.conf</code> file in <code>vim</code>. As explained in the comments at the top of the config file, the first column indicates the file extension. The second is whether the header and footer are case sensitive, the third is the header in hexadecimal bytes, the fourth column is an optional footer, and the fifth column is an optional parameter to search backwards from the header rather than just forward.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*Y6kTU1JxILxivTOYbHN5tQ.png" alt=""  />

With these options set, <code>scalpel</code> can now be ran to extract these files from the drive.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>scalpel -o recovered-files\_scalpel -c scalpel.conf sdb.img
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*O3huS4-S2BausvT-s2KiYw.png" alt=""  />

It appears that the text file was successfully recovered.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*jASCyrkTBYVfhWQxZkk3lg.png" alt=""  />

The image was recovered as well.</p>
<h1 id="conclusion"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*5ixUUenRR50lIavpZ0oyIw.png" alt=""  />

Conclusion</h1>
<p>There’s many ways to achieve the same outcome. The different tools showcased here have their specific applications where they perform best. Even though not all the methods outlined here worked for my particular situation, that doesn’t mean they won’t work for you. There are many factors that determine whether file recovery will be successful including the partitioning table type, how long it has been since they were deleted, the size of the file (smaller files are more likely to be recovered), the health of the storage device, and the operations that have been done on the drive since deleting the files such as reformatting the drive.</p>
<p>I hope that through reading this article, you were able to deepen your understanding of file recovery and gain practical knowledge that you can apply in the real world. Thanks for reading and I’ll see you next time.</p>
]]></content:encoded>
    </item>
    <item>
      <title>How to Encrypt a Drive in Linux</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2023-05-05_how-to-encrypt-a-drive-in-linux-83b3001744f4/</link>
      <pubDate>Fri, 05 May 2023 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2023-05-05_how-to-encrypt-a-drive-in-linux-83b3001744f4/</guid>
      <description>&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Hey everyone, this is a pretty quick article on LUKS drive encryption on Linux with the &lt;code&gt;cryptsetup&lt;/code&gt; library. By following the steps outlined here, you will be able to encrypt a drive, decrypt it, and mount it. This was done in a Kali Linux VM and commands may vary for other distributions.&lt;/p&gt;
&lt;p&gt;Disclaimer: This is not an area that I have much experience in so if details are inaccurate, I apologize in advance.&lt;/p&gt;
&lt;h2 id=&#34;creating-a-new-partition&#34;&gt;Creating a new partition&lt;/h2&gt;
&lt;p&gt;I’m using a virtual machine with 2 virtual hard disks.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*ao7i4G4xZFiEXNb2nX2-bQ.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;Demonstrating my disks with “lsblk -e7”&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I’ll be using a tool called &lt;code&gt;parted&lt;/code&gt; to create a partition on &lt;code&gt;/dev/sdb&lt;/code&gt;. Historically, when a system uses the Master Boot Record (MBR) partition table, &lt;code&gt;fdisk&lt;/code&gt; is used to manage the partition. In this article, I’ll use &lt;code&gt;parted&lt;/code&gt; because of its usability in scripting and automation.&lt;/p&gt;
&lt;p&gt;I’ll start by listing the information of the drives.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;parted -s /dev/sdb print all
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*5w3JBHztlFmtojmfpSwqAg.png&#34; alt=&#34;&#34;  /&gt;

The output &lt;code&gt;msdos&lt;/code&gt; under &lt;code&gt;/dev/sda&lt;/code&gt;, indicates that &lt;code&gt;sda&lt;/code&gt; is using the MBR partition table. Learn more about partition table types &lt;a href=&#34;https://en.wikipedia.org/wiki/Disk_partitioning&#34;&gt;here&lt;/a&gt; and &lt;a href=&#34;https://wiki.archlinux.org/title/Partitioning&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I’ll now create the GPT partition table on &lt;code&gt;/dev/sdb&lt;/code&gt;. You’ll notice that after running the command, &lt;code&gt;/dev/sdb&lt;/code&gt; now appears as a &lt;code&gt;gpt&lt;/code&gt; partition table.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*tZM4UvgCMQXekmpmoDJumg.png&#34; alt=&#34;&#34;  /&gt;

I then create a partition on the disk with the ext4 file system.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*dbuTKtvJcQZI4cFNANRylQ.png&#34; alt=&#34;&#34;  /&gt;

The commands I used for this are below. The values for the start and ending offsets when creating the partitions can be expressed in both percentages and exact byte values. Reference the &lt;a href=&#34;https://linux.die.net/man/8/parted&#34;&gt;man page&lt;/a&gt; for more details.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;parted -s /dev/sdb mklabel gpt  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;parted -s /dev/sdb mkpart primary ext4 0% 50MiB
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;encrypting-thedrive&#34;&gt;Encrypting the Drive&lt;/h2&gt;
&lt;p&gt;This demonstrates how to encrypt file system using LUKS. It is important to remember the passphrase that you enter while encrypting the partition because it is a key piece of information when decrypting the drive.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cryptsetup luksFormat /dev/sdb # encrypt /dev/sdb with luks
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;decrypting-thedrive&#34;&gt;Decrypting the Drive&lt;/h2&gt;
&lt;p&gt;You’ll need to do this before you’re able to mount and use the partition on the drive.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cryptsetup open /dev/sdb encrypted # open the encrypted drive as /dev/mapper/encrypted  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkfs.ext4 /dev/mapper/encrypted # create a filesystem on the device (only needed the first time you open the encrypted drive)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;mounting-the-partition&#34;&gt;Mounting the Partition&lt;/h2&gt;
&lt;p&gt;In order to actually use the partition and the file system on it, we must mount it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p /mnt/encrypted # prepare the mount point  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mount /dev/mapper/encrypted /mnt/encrypted # mount the decrypted filesystem on /mnt/encrypted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;unmounting-the-partition&#34;&gt;Unmounting the Partition&lt;/h2&gt;
&lt;p&gt;When you’re done using the drive, you can unmount it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;umount /mnt/encrypted 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;closing-and-re-encrypting-the-partition&#34;&gt;Closing and Re-encrypting the Partition&lt;/h2&gt;
&lt;p&gt;In its unmounted state, it is still decrypted. To re-encrypt and close the drive, you can run the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cryptsetup close /dev/mapper/encrypted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;digging-deeper&#34;&gt;Digging Deeper&lt;/h1&gt;
&lt;p&gt;Because I’m a curious person, I’ll share with you some commands that you can use to get more information on the file system that you just created and other findings that I thought were interesting.&lt;/p&gt;
&lt;h2 id=&#34;file-systemmetadata&#34;&gt;File System Metadata&lt;/h2&gt;
&lt;p&gt;After decrypting the drive, you can view the metadata of your filesystem.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cryptsetup --type luks open /dev/sdb encrypted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These are some commands that will give you infromation.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;df -hT /dev/mapper/encrypted  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tune2fs -l /dev/sdb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As shown in the screenshots, you’re able to view the number of inodes, the block count, block size, filesystem magic number, and much more.&lt;/p&gt;
&lt;h2 id=&#34;inodes&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*k6QJaeh0pBMsxnfbGk6Rog.png&#34; alt=&#34;&#34;  /&gt;

&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*BXNCkBoJaesaE0AfBZlOsQ.png&#34; alt=&#34;&#34;  /&gt;

Inodes&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Inode&#34;&gt;Inodes&lt;/a&gt; are a data structure that contain information about files in the Linux filesystem. It contains metadata such as the block number that the file is located in on the hard drive, permissions, and file owner. In an ext4 filesystem, the number of inodes in is fixed, whereas in XFS and JFS, the number of inodes is dynamic. The result is that in ext4 filesystems where many inodes are used, such as in situations where many directories, symbolic links, and/or small files are made, an error message that the system is out of space may occur when there is plenty of space left. The reason for this is simply that the filesystem has no more available inodes to assign to new files. This is a relatively common occurence for mail servers that often hold many small files.&lt;/p&gt;
&lt;p&gt;The number of inodes on your system’s filesystems can be viewed with &lt;code&gt;df -hi&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*_TgsDD7BK_fPitV0J31ywg.png&#34; alt=&#34;&#34;  /&gt;

You can query the inode information on a specific file with the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ls -il file
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*nBvEce088HNvxUbcz1cF7w.png&#34; alt=&#34;&#34;  /&gt;

The inode number is on the leftmost column of output. In this case, it is &lt;code&gt;131079&lt;/code&gt;. Additionally, you can see the read, write, and execute permissions on the file with the owner and group associated with it.&lt;/p&gt;
&lt;p&gt;As an alternative, you can search for the file that is associated with a specific inode with this command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;find / -inum 1234567 -ls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*15DlndsZGVZ0Q9A3lAtXeg.png&#34; alt=&#34;&#34;  /&gt;

I was able to find the file &lt;code&gt;/tmp/test.txt&lt;/code&gt; that was associated with &lt;code&gt;131079&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;duplicating-the-encrypted-drive&#34;&gt;Duplicating the Encrypted Drive&lt;/h2&gt;
&lt;p&gt;This command can be used to create an exact duplicate of &lt;code&gt;/dev/sdb&lt;/code&gt; in &lt;code&gt;/media/sdb.img&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dd if=/dev/sdb of=/media/sdb.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;next-steps&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*hzoKv4rgFMHTAQtFFIcaYQ.png&#34; alt=&#34;&#34;  /&gt;

Next Steps&lt;/h1&gt;
&lt;p&gt;Moving forward, you can expand upon what was done in this article by implementing an added layer of abstraction and flexibility with &lt;a href=&#34;https://linuxconfig.org/linux-lvm-logical-volume-manager&#34;&gt;LVM&lt;/a&gt;. You can also continue to experiment with different ways of encrypting partitions such as those outlined in &lt;a href=&#34;https://www.baeldung.com/linux/encrypt-partition&#34;&gt;this article&lt;/a&gt;. There are many different ways to configure your system and I would encourage you to continue learning. Thank you for reading!&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<h2 id="introduction">Introduction</h2>
<p>Hey everyone, this is a pretty quick article on LUKS drive encryption on Linux with the <code>cryptsetup</code> library. By following the steps outlined here, you will be able to encrypt a drive, decrypt it, and mount it. This was done in a Kali Linux VM and commands may vary for other distributions.</p>
<p>Disclaimer: This is not an area that I have much experience in so if details are inaccurate, I apologize in advance.</p>
<h2 id="creating-a-new-partition">Creating a new partition</h2>
<p>I’m using a virtual machine with 2 virtual hard disks.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*ao7i4G4xZFiEXNb2nX2-bQ.png" alt=""  />

<em>Demonstrating my disks with “lsblk -e7”</em></p>
<p>I’ll be using a tool called <code>parted</code> to create a partition on <code>/dev/sdb</code>. Historically, when a system uses the Master Boot Record (MBR) partition table, <code>fdisk</code> is used to manage the partition. In this article, I’ll use <code>parted</code> because of its usability in scripting and automation.</p>
<p>I’ll start by listing the information of the drives.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>parted -s /dev/sdb print all
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*5w3JBHztlFmtojmfpSwqAg.png" alt=""  />

The output <code>msdos</code> under <code>/dev/sda</code>, indicates that <code>sda</code> is using the MBR partition table. Learn more about partition table types <a href="https://en.wikipedia.org/wiki/Disk_partitioning">here</a> and <a href="https://wiki.archlinux.org/title/Partitioning">here</a>.</p>
<p>I’ll now create the GPT partition table on <code>/dev/sdb</code>. You’ll notice that after running the command, <code>/dev/sdb</code> now appears as a <code>gpt</code> partition table.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*tZM4UvgCMQXekmpmoDJumg.png" alt=""  />

I then create a partition on the disk with the ext4 file system.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*dbuTKtvJcQZI4cFNANRylQ.png" alt=""  />

The commands I used for this are below. The values for the start and ending offsets when creating the partitions can be expressed in both percentages and exact byte values. Reference the <a href="https://linux.die.net/man/8/parted">man page</a> for more details.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>parted -s /dev/sdb mklabel gpt  
</span></span><span style="display:flex;"><span>parted -s /dev/sdb mkpart primary ext4 0% 50MiB
</span></span></code></pre></div><h2 id="encrypting-thedrive">Encrypting the Drive</h2>
<p>This demonstrates how to encrypt file system using LUKS. It is important to remember the passphrase that you enter while encrypting the partition because it is a key piece of information when decrypting the drive.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cryptsetup luksFormat /dev/sdb # encrypt /dev/sdb with luks
</span></span></code></pre></div><h2 id="decrypting-thedrive">Decrypting the Drive</h2>
<p>You’ll need to do this before you’re able to mount and use the partition on the drive.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cryptsetup open /dev/sdb encrypted # open the encrypted drive as /dev/mapper/encrypted  
</span></span><span style="display:flex;"><span>mkfs.ext4 /dev/mapper/encrypted # create a filesystem on the device (only needed the first time you open the encrypted drive)
</span></span></code></pre></div><h2 id="mounting-the-partition">Mounting the Partition</h2>
<p>In order to actually use the partition and the file system on it, we must mount it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkdir -p /mnt/encrypted # prepare the mount point  
</span></span><span style="display:flex;"><span>mount /dev/mapper/encrypted /mnt/encrypted # mount the decrypted filesystem on /mnt/encrypted
</span></span></code></pre></div><h2 id="unmounting-the-partition">Unmounting the Partition</h2>
<p>When you’re done using the drive, you can unmount it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>umount /mnt/encrypted 
</span></span></code></pre></div><h2 id="closing-and-re-encrypting-the-partition">Closing and Re-encrypting the Partition</h2>
<p>In its unmounted state, it is still decrypted. To re-encrypt and close the drive, you can run the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cryptsetup close /dev/mapper/encrypted
</span></span></code></pre></div><h1 id="digging-deeper">Digging Deeper</h1>
<p>Because I’m a curious person, I’ll share with you some commands that you can use to get more information on the file system that you just created and other findings that I thought were interesting.</p>
<h2 id="file-systemmetadata">File System Metadata</h2>
<p>After decrypting the drive, you can view the metadata of your filesystem.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cryptsetup --type luks open /dev/sdb encrypted
</span></span></code></pre></div><p>These are some commands that will give you infromation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>df -hT /dev/mapper/encrypted  
</span></span><span style="display:flex;"><span>tune2fs -l /dev/sdb
</span></span></code></pre></div><p>As shown in the screenshots, you’re able to view the number of inodes, the block count, block size, filesystem magic number, and much more.</p>
<h2 id="inodes"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*k6QJaeh0pBMsxnfbGk6Rog.png" alt=""  />

<img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*BXNCkBoJaesaE0AfBZlOsQ.png" alt=""  />

Inodes</h2>
<p><a href="https://en.wikipedia.org/wiki/Inode">Inodes</a> are a data structure that contain information about files in the Linux filesystem. It contains metadata such as the block number that the file is located in on the hard drive, permissions, and file owner. In an ext4 filesystem, the number of inodes in is fixed, whereas in XFS and JFS, the number of inodes is dynamic. The result is that in ext4 filesystems where many inodes are used, such as in situations where many directories, symbolic links, and/or small files are made, an error message that the system is out of space may occur when there is plenty of space left. The reason for this is simply that the filesystem has no more available inodes to assign to new files. This is a relatively common occurence for mail servers that often hold many small files.</p>
<p>The number of inodes on your system’s filesystems can be viewed with <code>df -hi</code>.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*_TgsDD7BK_fPitV0J31ywg.png" alt=""  />

You can query the inode information on a specific file with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ls -il file
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*nBvEce088HNvxUbcz1cF7w.png" alt=""  />

The inode number is on the leftmost column of output. In this case, it is <code>131079</code>. Additionally, you can see the read, write, and execute permissions on the file with the owner and group associated with it.</p>
<p>As an alternative, you can search for the file that is associated with a specific inode with this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>find / -inum 1234567 -ls
</span></span></code></pre></div><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*15DlndsZGVZ0Q9A3lAtXeg.png" alt=""  />

I was able to find the file <code>/tmp/test.txt</code> that was associated with <code>131079</code>.</p>
<h2 id="duplicating-the-encrypted-drive">Duplicating the Encrypted Drive</h2>
<p>This command can be used to create an exact duplicate of <code>/dev/sdb</code> in <code>/media/sdb.img</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>dd if=/dev/sdb of=/media/sdb.img
</span></span></code></pre></div><h1 id="next-steps"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*hzoKv4rgFMHTAQtFFIcaYQ.png" alt=""  />

Next Steps</h1>
<p>Moving forward, you can expand upon what was done in this article by implementing an added layer of abstraction and flexibility with <a href="https://linuxconfig.org/linux-lvm-logical-volume-manager">LVM</a>. You can also continue to experiment with different ways of encrypting partitions such as those outlined in <a href="https://www.baeldung.com/linux/encrypt-partition">this article</a>. There are many different ways to configure your system and I would encourage you to continue learning. Thank you for reading!</p>
]]></content:encoded>
    </item>
    <item>
      <title>Snort IPS Quickstart</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2023-05-02_snort-ips-quickstart-27559ae01fae/</link>
      <pubDate>Tue, 02 May 2023 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2023-05-02_snort-ips-quickstart-27559ae01fae/</guid>
      <description>&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Snort is an open source Intrusion Prevention System (IPS) that detects malicious network traffic by comparing the network packets to a set of rules, often created by Snort and the community. Snort can be used as a packet sniffer, packet logger, and intrusion prevention system.&lt;/p&gt;
&lt;p&gt;In this article, I’ll go over some of the first steps of installing, configuring, and running Snort so that new users have a place to branch off of.&lt;/p&gt;
&lt;h1 id=&#34;quick-install&#34;&gt;Quick Install&lt;/h1&gt;
&lt;p&gt;You can install this on Ubuntu easily with the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get install snort
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;kali-linux&#34;&gt;Kali Linux&lt;/h2&gt;
&lt;p&gt;For my Kali friends, you might get the message that you’re unable to locate the &lt;code&gt;snort&lt;/code&gt; package when trying to install it. This happens because the repositories that your distribution looks into when searching for apt packages doesn’t contain &lt;code&gt;snort&lt;/code&gt;. To fix this, you can try to append the following repos to your &lt;code&gt;/etc/apt/sources.list&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deb http://http.kali.org/kali kali-rolling main non-free contrib  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deb http://http.kali.org/kali sana main non-free contrib  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deb http://security.kali.org/kali-security sana/updates main contrib non-free  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deb http://old.kali.org/kali moto main non-free contrib
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let the changes take effect and install Snort.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get update  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get install snort
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;building-fromsource&#34;&gt;Building From Source&lt;/h1&gt;
&lt;p&gt;If you’re crazy enough to build Snort from the source code, this section is for you.&lt;/p&gt;
&lt;h2 id=&#34;installing-dependencies&#34;&gt;Installing Dependencies&lt;/h2&gt;
&lt;p&gt;Before you can build Snort, you must first install its dependencies. These are listed in their &lt;a href=&#34;https://github.com/snort3/snort3#dependencies&#34;&gt;README.md&lt;/a&gt; on GitHub, but for the sake of brevity, I’ll put some of them here. Keep in mind that some of the dependencies have more dependencies which is why some appear below and not in the documentation.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt install &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;y gcc libpcre3&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev zlib1g&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libluajit&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5.1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;libpcap&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev openssl libssl&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libnghttp2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libdumbnet&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bison flex libdnet autoconf libtool cmake
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;daq&#34;&gt;DAQ&lt;/h2&gt;
&lt;p&gt;Snort has another depenency called DAQ that needs to be installed. I’ll be downloading their latest release form GitHub and extracting it in a folder called &lt;code&gt;daq&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ wget https://github.com/snort3/libdaq/archive/refs/tags/v3.0.11.zip  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ unzip v3.0.11.zip -d daq &amp;amp;&amp;amp; cd daq/libdaq-3.0.11
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After downloading and extracting it, I’ll run &lt;code&gt;bootstrap&lt;/code&gt; to generate the configuration script and then proceed to install it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./bootstrap  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; sudo make install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;hwloc&#34;&gt;hwloc&lt;/h2&gt;
&lt;p&gt;Another dependency is &lt;code&gt;hwloc&lt;/code&gt;. You can find additional methods of installation on their &lt;a href=&#34;https://github.com/open-mpi/hwloc&#34;&gt;GitHub&lt;/a&gt; and &lt;a href=&#34;https://www.open-mpi.org/software/hwloc/v2.9/&#34;&gt;website&lt;/a&gt;. This is the way that I did it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git clone https://github.com/open-mpi/hwloc.git  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cd hwloc &amp;amp;&amp;amp; ./autogen.sh  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; sudo make install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;openssl&#34;&gt;OpenSSL&lt;/h2&gt;
&lt;p&gt;If you don’t already have &lt;code&gt;openssl&lt;/code&gt; installed on your system, you could install it from source:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git clone https://github.com/openssl/openssl.git &amp;amp;&amp;amp; cd openssl  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ./Configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It is also possible to install it through &lt;code&gt;apt&lt;/code&gt;. You may still need to install some additional headers for Snort to work. For this, you can try&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt install libssl-dev openssl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;snort-install&#34;&gt;Snort Install&lt;/h2&gt;
&lt;p&gt;Finally, we can start building Snort. I’ll be building directly from their source code on GitHub. Following the instructions on their README.md in &lt;a href=&#34;https://github.com/snort3/snort3#readme&#34;&gt;GitHub&lt;/a&gt;, I clone their GitHub repository and run these commands:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ git clone https://github.com/snort3/snort3.git  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cd snort3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, I’ll build the program. You’ll need &lt;code&gt;cmake&lt;/code&gt; among other packages in order to do this, so I’ve included the install command for those packages.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; sudo apt install &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;y gcc cmake libpcre3&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev zlib1g&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libluajit&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5.1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libpcap&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev openssl libssl&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libnghttp2&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev libdumbnet&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dev bison flex autoconf libtool  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;./&lt;/span&gt;configure\_cmake&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sh &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;prefix&lt;span style=&#34;color:#f92672&#34;&gt;=$&lt;/span&gt;(pwd) &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;with&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;daq&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;libraries&lt;span style=&#34;color:#f92672&#34;&gt;=/&lt;/span&gt;path&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;to&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;libdaq&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3.0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; cd build  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; make &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;j &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;(nproc) install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;configuration&#34;&gt;Configuration&lt;/h1&gt;
&lt;h2 id=&#34;capturing-all-networktraffic&#34;&gt;Capturing all Network Traffic&lt;/h2&gt;
&lt;p&gt;To start, we’ll set our network adapter to run in promiscuous mode. This means that it will capture all packets on the network rather than only the ones that were assigned to be captured by it. This can be done through WiFi settings or through the command line.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo ip link set wlan0 promisc on
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;modifying-the-configuration-file&#34;&gt;Modifying the Configuration File&lt;/h2&gt;
&lt;p&gt;Most configurations will go within &lt;code&gt;/etc/snort/snort.conf&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo vim /etc/snort/snort.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There’s many configuration options within this file that are broken up into 9 sections. Most of our changes will be in section 1.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*pngRmEDDXcscoXuasWQFdQ.png&#34; alt=&#34;&#34;  /&gt;

On line 45 of the configuration file, we’ll change the value of &lt;code&gt;HOME_NET&lt;/code&gt; from &lt;code&gt;any&lt;/code&gt; to be the network that you would like to monitor. In my case, it is &lt;code&gt;192.168.1.0/24&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*uPIpmb3Q2AUJj3v3GkL2lQ.png&#34; alt=&#34;&#34;  /&gt;

I would encourage you to go through the other variables in the configuration file to include the ports and hosts that are running various services so that Snort can detect them and apply the rules to them.&lt;/p&gt;
&lt;p&gt;Rules are included in step #7. The syntax for rule files is &lt;code&gt;include /path/to/rule.rules&lt;/code&gt;. In this case, &lt;code&gt;$RULE_PATH&lt;/code&gt; refers to &lt;code&gt;/etc/snort&lt;/code&gt;. You can include multiple rule files and add your own under &lt;code&gt;/etc/snort/local.rules&lt;/code&gt; or whichever file name that you configure for you own rules. This structure allows you to compartmentalize various rule sets and keep them organized.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*Pz6IDFwxqQwrMWmZS83kQg.png&#34; alt=&#34;&#34;  /&gt;

As a side note, if you would like to download the latest community rules, you can find them at the &lt;a href=&#34;https://www.snort.org/downloads#rules&#34;&gt;official website&lt;/a&gt;. You would extract the tarball and add the rule files to your &lt;code&gt;/etc/snort/snort.conf&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; wget https:&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;www&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;snort&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;org&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;downloads&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;community&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;snort3&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;community&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;rules&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tar&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;gz  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt; tar &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;xf snort3&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;community&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;rules&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tar&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;running-snort&#34;&gt;Running Snort&lt;/h1&gt;
&lt;p&gt;Once you have your configuration file created, you can test that everything works with the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo snort -T -i wlan0 -c /etc/snort/snort.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You will get a lot of output. The most important pieces of information to be aware of in this output are the Snort rules. Here, you will be able to see how many were loaded in.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*4STD2kRrAx3xnRfCA7ALqA.png&#34; alt=&#34;&#34;  /&gt;

To actually run Snort as a daemon, you would change the &lt;code&gt;-T&lt;/code&gt; option to &lt;code&gt;-D&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo snort -D -i eth0 -c /etc/snort/snort.conf  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Spawning daemon child...  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;My daemon child 197993 lives...  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Daemon parent exiting (0)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To verify that it is working, you can use &lt;code&gt;ps aux&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ps aux | grep snort  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;root 196973 0.0 0.3 450316 118644 ? Ssl 10:25 0:00 snort -D -i wlan0 -c /etc/snort/snort.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;All alerts from Snort will be sent to &lt;code&gt;/var/log/snort/alert&lt;/code&gt; unless otherwise specified in a command line argument.&lt;/p&gt;
&lt;h1 id=&#34;moving-forward&#34;&gt;Moving Forward&lt;/h1&gt;
&lt;p&gt;For those who are interested in learning Snort on a deeper level, one recommendation is learning how to create your own rules and learning what the other configuration options are. It may be worth it to read their &lt;code&gt;man&lt;/code&gt; page as well to be aware of options available on the CLI. You can also combine Snort with a SIEM such as Splunk and other solutions like pfSense.&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<h1 id="introduction">Introduction</h1>
<p>Snort is an open source Intrusion Prevention System (IPS) that detects malicious network traffic by comparing the network packets to a set of rules, often created by Snort and the community. Snort can be used as a packet sniffer, packet logger, and intrusion prevention system.</p>
<p>In this article, I’ll go over some of the first steps of installing, configuring, and running Snort so that new users have a place to branch off of.</p>
<h1 id="quick-install">Quick Install</h1>
<p>You can install this on Ubuntu easily with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo apt-get install snort
</span></span></code></pre></div><h2 id="kali-linux">Kali Linux</h2>
<p>For my Kali friends, you might get the message that you’re unable to locate the <code>snort</code> package when trying to install it. This happens because the repositories that your distribution looks into when searching for apt packages doesn’t contain <code>snort</code>. To fix this, you can try to append the following repos to your <code>/etc/apt/sources.list</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>deb http://http.kali.org/kali kali-rolling main non-free contrib  
</span></span><span style="display:flex;"><span>deb http://http.kali.org/kali sana main non-free contrib  
</span></span><span style="display:flex;"><span>deb http://security.kali.org/kali-security sana/updates main contrib non-free  
</span></span><span style="display:flex;"><span>deb http://old.kali.org/kali moto main non-free contrib
</span></span></code></pre></div><p>Let the changes take effect and install Snort.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo apt-get update  
</span></span><span style="display:flex;"><span>$ sudo apt-get install snort
</span></span></code></pre></div><h1 id="building-fromsource">Building From Source</h1>
<p>If you’re crazy enough to build Snort from the source code, this section is for you.</p>
<h2 id="installing-dependencies">Installing Dependencies</h2>
<p>Before you can build Snort, you must first install its dependencies. These are listed in their <a href="https://github.com/snort3/snort3#dependencies">README.md</a> on GitHub, but for the sake of brevity, I’ll put some of them here. Keep in mind that some of the dependencies have more dependencies which is why some appear below and not in the documentation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>sudo apt update <span style="color:#f92672">&amp;&amp;</span> apt install <span style="color:#f92672">-</span>y gcc libpcre3<span style="color:#f92672">-</span>dev zlib1g<span style="color:#f92672">-</span>dev libluajit<span style="color:#f92672">-</span><span style="color:#ae81ff">5.1</span><span style="color:#f92672">-</span>dev   
</span></span><span style="display:flex;"><span>libpcap<span style="color:#f92672">-</span>dev openssl libssl<span style="color:#f92672">-</span>dev libnghttp2<span style="color:#f92672">-</span>dev libdumbnet<span style="color:#f92672">-</span>dev   
</span></span><span style="display:flex;"><span>bison flex libdnet autoconf libtool cmake
</span></span></code></pre></div><h2 id="daq">DAQ</h2>
<p>Snort has another depenency called DAQ that needs to be installed. I’ll be downloading their latest release form GitHub and extracting it in a folder called <code>daq</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ wget https://github.com/snort3/libdaq/archive/refs/tags/v3.0.11.zip  
</span></span><span style="display:flex;"><span>$ unzip v3.0.11.zip -d daq &amp;&amp; cd daq/libdaq-3.0.11
</span></span></code></pre></div><p>After downloading and extracting it, I’ll run <code>bootstrap</code> to generate the configuration script and then proceed to install it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ./bootstrap  
</span></span><span style="display:flex;"><span>$ ./configure &amp;&amp; make &amp;&amp; sudo make install
</span></span></code></pre></div><h2 id="hwloc">hwloc</h2>
<p>Another dependency is <code>hwloc</code>. You can find additional methods of installation on their <a href="https://github.com/open-mpi/hwloc">GitHub</a> and <a href="https://www.open-mpi.org/software/hwloc/v2.9/">website</a>. This is the way that I did it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ git clone https://github.com/open-mpi/hwloc.git  
</span></span><span style="display:flex;"><span>$ cd hwloc &amp;&amp; ./autogen.sh  
</span></span><span style="display:flex;"><span>$ ./configure &amp;&amp; make &amp;&amp; sudo make install
</span></span></code></pre></div><h2 id="openssl">OpenSSL</h2>
<p>If you don’t already have <code>openssl</code> installed on your system, you could install it from source:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ git clone https://github.com/openssl/openssl.git &amp;&amp; cd openssl  
</span></span><span style="display:flex;"><span>$ ./Configure &amp;&amp; make &amp;&amp; make test
</span></span></code></pre></div><p>It is also possible to install it through <code>apt</code>. You may still need to install some additional headers for Snort to work. For this, you can try</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo apt install libssl-dev openssl
</span></span></code></pre></div><h2 id="snort-install">Snort Install</h2>
<p>Finally, we can start building Snort. I’ll be building directly from their source code on GitHub. Following the instructions on their README.md in <a href="https://github.com/snort3/snort3#readme">GitHub</a>, I clone their GitHub repository and run these commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ git clone https://github.com/snort3/snort3.git  
</span></span><span style="display:flex;"><span>$ cd snort3
</span></span></code></pre></div><p>Then, I’ll build the program. You’ll need <code>cmake</code> among other packages in order to do this, so I’ve included the install command for those packages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">$</span> sudo apt install <span style="color:#f92672">-</span>y gcc cmake libpcre3<span style="color:#f92672">-</span>dev zlib1g<span style="color:#f92672">-</span>dev libluajit<span style="color:#f92672">-</span><span style="color:#ae81ff">5.1</span><span style="color:#f92672">-</span>dev libpcap<span style="color:#f92672">-</span>dev openssl libssl<span style="color:#f92672">-</span>dev libnghttp2<span style="color:#f92672">-</span>dev libdumbnet<span style="color:#f92672">-</span>dev bison flex autoconf libtool  
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> <span style="color:#f92672">./</span>configure\_cmake<span style="color:#f92672">.</span>sh <span style="color:#f92672">--</span>prefix<span style="color:#f92672">=$</span>(pwd) <span style="color:#f92672">--</span>with<span style="color:#f92672">-</span>daq<span style="color:#f92672">-</span>libraries<span style="color:#f92672">=/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>libdaq<span style="color:#f92672">-</span><span style="color:#ae81ff">3.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">11</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> cd build  
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> make <span style="color:#f92672">-</span>j <span style="color:#f92672">$</span>(nproc) install
</span></span></code></pre></div><h1 id="configuration">Configuration</h1>
<h2 id="capturing-all-networktraffic">Capturing all Network Traffic</h2>
<p>To start, we’ll set our network adapter to run in promiscuous mode. This means that it will capture all packets on the network rather than only the ones that were assigned to be captured by it. This can be done through WiFi settings or through the command line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo ip link set wlan0 promisc on
</span></span></code></pre></div><h2 id="modifying-the-configuration-file">Modifying the Configuration File</h2>
<p>Most configurations will go within <code>/etc/snort/snort.conf</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo vim /etc/snort/snort.conf
</span></span></code></pre></div><p>There’s many configuration options within this file that are broken up into 9 sections. Most of our changes will be in section 1.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*pngRmEDDXcscoXuasWQFdQ.png" alt=""  />

On line 45 of the configuration file, we’ll change the value of <code>HOME_NET</code> from <code>any</code> to be the network that you would like to monitor. In my case, it is <code>192.168.1.0/24</code>.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*uPIpmb3Q2AUJj3v3GkL2lQ.png" alt=""  />

I would encourage you to go through the other variables in the configuration file to include the ports and hosts that are running various services so that Snort can detect them and apply the rules to them.</p>
<p>Rules are included in step #7. The syntax for rule files is <code>include /path/to/rule.rules</code>. In this case, <code>$RULE_PATH</code> refers to <code>/etc/snort</code>. You can include multiple rule files and add your own under <code>/etc/snort/local.rules</code> or whichever file name that you configure for you own rules. This structure allows you to compartmentalize various rule sets and keep them organized.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*Pz6IDFwxqQwrMWmZS83kQg.png" alt=""  />

As a side note, if you would like to download the latest community rules, you can find them at the <a href="https://www.snort.org/downloads#rules">official website</a>. You would extract the tarball and add the rule files to your <code>/etc/snort/snort.conf</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">$</span> wget https:<span style="color:#f92672">//</span>www<span style="color:#f92672">.</span>snort<span style="color:#f92672">.</span>org<span style="color:#f92672">/</span>downloads<span style="color:#f92672">/</span>community<span style="color:#f92672">/</span>snort3<span style="color:#f92672">-</span>community<span style="color:#f92672">-</span>rules<span style="color:#f92672">.</span>tar<span style="color:#f92672">.</span>gz  
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span> tar <span style="color:#f92672">-</span>xf snort3<span style="color:#f92672">-</span>community<span style="color:#f92672">-</span>rules<span style="color:#f92672">.</span>tar<span style="color:#f92672">.</span>gz
</span></span></code></pre></div><h1 id="running-snort">Running Snort</h1>
<p>Once you have your configuration file created, you can test that everything works with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo snort -T -i wlan0 -c /etc/snort/snort.conf
</span></span></code></pre></div><p>You will get a lot of output. The most important pieces of information to be aware of in this output are the Snort rules. Here, you will be able to see how many were loaded in.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*4STD2kRrAx3xnRfCA7ALqA.png" alt=""  />

To actually run Snort as a daemon, you would change the <code>-T</code> option to <code>-D</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sudo snort -D -i eth0 -c /etc/snort/snort.conf  
</span></span><span style="display:flex;"><span>Spawning daemon child...  
</span></span><span style="display:flex;"><span>My daemon child 197993 lives...  
</span></span><span style="display:flex;"><span>Daemon parent exiting (0)
</span></span></code></pre></div><p>To verify that it is working, you can use <code>ps aux</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ps aux | grep snort  
</span></span><span style="display:flex;"><span>root 196973 0.0 0.3 450316 118644 ? Ssl 10:25 0:00 snort -D -i wlan0 -c /etc/snort/snort.conf
</span></span></code></pre></div><p>All alerts from Snort will be sent to <code>/var/log/snort/alert</code> unless otherwise specified in a command line argument.</p>
<h1 id="moving-forward">Moving Forward</h1>
<p>For those who are interested in learning Snort on a deeper level, one recommendation is learning how to create your own rules and learning what the other configuration options are. It may be worth it to read their <code>man</code> page as well to be aware of options available on the CLI. You can also combine Snort with a SIEM such as Splunk and other solutions like pfSense.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Restoring Files in /usr/include</title>
      <link>http://localhost:1313/ally-petitt/en/posts/2023-04-13_restoring-files-in--usr-include-88622911c3ae/</link>
      <pubDate>Thu, 13 Apr 2023 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/ally-petitt/en/posts/2023-04-13_restoring-files-in--usr-include-88622911c3ae/</guid>
      <description>&lt;p&gt;Hi guys, I made a mistake. In my frustration trying to debug my C program, I inadvertently deleted all the files within my &lt;code&gt;/usr/include&lt;/code&gt; folder. I didn’t realize at the time that this was a very important folder! As explained &lt;a href=&#34;https://www.kernel.org/doc/Documentation/kbuild/headers_install.txt&#34;&gt;here&lt;/a&gt;, it stores the Linux kernel’s libc header files! Rookie mistake, but luckily for us, there’s ways to fix it.&lt;/p&gt;
&lt;p&gt;If your &lt;code&gt;/usr/include&lt;/code&gt; folder is also looking more empty than the shelves during COVID, I come bearing the solution.&lt;/p&gt;
&lt;h1 id=&#34;getting-kernelheaders&#34;&gt;Getting Kernel Headers&lt;/h1&gt;
&lt;p&gt;You’ll want to download the kernel install from here: &lt;a href=&#34;https://www.kernel.org/&#34;&gt;https://www.kernel.org/&lt;/a&gt;. Choose the one that matches your Linux kernel version as close as possible. I’ll be using 6.2.10. From there, we’ll decompress the file and copy the contents of the include folder to &lt;code&gt;/usr/include&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# download the linux kernel files form kernel.org  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https:&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;cdn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;kernel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;org&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;pub&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;linux&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;kernel&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;linux&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6.2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10.&lt;/span&gt;tar&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;xz  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;xf linux&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6.2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10.&lt;/span&gt;tar&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;xz &lt;span style=&#34;color:#75715e&#34;&gt;# decompress the tarball  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# copy the contents of the include folder into /usr/include/  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cp &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;r &lt;span style=&#34;color:#f92672&#34;&gt;./&lt;/span&gt;linux&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6.2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10.&lt;/span&gt;tar&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;xz&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;include&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;usr&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;include&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;restoring-additional-missingfiles&#34;&gt;Restoring Additional Missing Files&lt;/h1&gt;
&lt;p&gt;If you find that while compiling something, you still get errors, try this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt-file search /path/to/&amp;lt;MISSING\_HEADER&amp;gt;.h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In my case, I was missing &lt;code&gt;string.h&lt;/code&gt;, so I used &lt;code&gt;apt-file search /usr/include/string.h&lt;/code&gt; to see that I was needing the &lt;code&gt;libc6-dev&lt;/code&gt; library.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*fAw86hUT7orMXK8ZVFfZHQ.png&#34; alt=&#34;&#34;  /&gt;

I had this installed previously, but since I deleted the files, I need to remove the installation completely and reinstall it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt remove --purge libc6-dev  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install libc6-dev
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I also had to do the same with &lt;code&gt;linux-libc-dev&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt remove --purge linux-libc-dev  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install linux-libc-dev
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Continue on with this methodology until you’ve installed all your missing dependencies. With these two steps combined, you should be able to restore your &lt;code&gt;/usr/include&lt;/code&gt; file. This worked for me. Best of luck!&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<p>Hi guys, I made a mistake. In my frustration trying to debug my C program, I inadvertently deleted all the files within my <code>/usr/include</code> folder. I didn’t realize at the time that this was a very important folder! As explained <a href="https://www.kernel.org/doc/Documentation/kbuild/headers_install.txt">here</a>, it stores the Linux kernel’s libc header files! Rookie mistake, but luckily for us, there’s ways to fix it.</p>
<p>If your <code>/usr/include</code> folder is also looking more empty than the shelves during COVID, I come bearing the solution.</p>
<h1 id="getting-kernelheaders">Getting Kernel Headers</h1>
<p>You’ll want to download the kernel install from here: <a href="https://www.kernel.org/">https://www.kernel.org/</a>. Choose the one that matches your Linux kernel version as close as possible. I’ll be using 6.2.10. From there, we’ll decompress the file and copy the contents of the include folder to <code>/usr/include</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># download the linux kernel files form kernel.org  </span>
</span></span><span style="display:flex;"><span>wget https:<span style="color:#f92672">//</span>cdn<span style="color:#f92672">.</span>kernel<span style="color:#f92672">.</span>org<span style="color:#f92672">/</span>pub<span style="color:#f92672">/</span>linux<span style="color:#f92672">/</span>kernel<span style="color:#f92672">/</span>v6<span style="color:#f92672">.</span>x<span style="color:#f92672">/</span>linux<span style="color:#f92672">-</span><span style="color:#ae81ff">6.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">10.</span>tar<span style="color:#f92672">.</span>xz  
</span></span><span style="display:flex;"><span>tar <span style="color:#f92672">-</span>xf linux<span style="color:#f92672">-</span><span style="color:#ae81ff">6.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">10.</span>tar<span style="color:#f92672">.</span>xz <span style="color:#75715e"># decompress the tarball  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># copy the contents of the include folder into /usr/include/  </span>
</span></span><span style="display:flex;"><span>sudo cp <span style="color:#f92672">-</span>r <span style="color:#f92672">./</span>linux<span style="color:#f92672">-</span><span style="color:#ae81ff">6.2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">10.</span>tar<span style="color:#f92672">.</span>xz<span style="color:#f92672">/</span>include<span style="color:#f92672">/</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>include<span style="color:#f92672">/</span>
</span></span></code></pre></div><h1 id="restoring-additional-missingfiles">Restoring Additional Missing Files</h1>
<p>If you find that while compiling something, you still get errors, try this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>apt-file search /path/to/&lt;MISSING\_HEADER&gt;.h
</span></span></code></pre></div><p>In my case, I was missing <code>string.h</code>, so I used <code>apt-file search /usr/include/string.h</code> to see that I was needing the <code>libc6-dev</code> library.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*fAw86hUT7orMXK8ZVFfZHQ.png" alt=""  />

I had this installed previously, but since I deleted the files, I need to remove the installation completely and reinstall it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt remove --purge libc6-dev  
</span></span><span style="display:flex;"><span>sudo apt install libc6-dev
</span></span></code></pre></div><p>I also had to do the same with <code>linux-libc-dev</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt remove --purge linux-libc-dev  
</span></span><span style="display:flex;"><span>sudo apt install linux-libc-dev
</span></span></code></pre></div><p>Continue on with this methodology until you’ve installed all your missing dependencies. With these two steps combined, you should be able to restore your <code>/usr/include</code> file. This worked for me. Best of luck!</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
